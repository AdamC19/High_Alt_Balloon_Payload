ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"sd_card_spi.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "Core/Src/sd_card_spi.c"
  20              		.section	.text.xchg_spi,"ax",%progbits
  21              		.align	1
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	xchg_spi:
  27              	.LVL0:
  28              	.LFB125:
   1:Core/Src/sd_card_spi.c **** 
   2:Core/Src/sd_card_spi.c **** #include "stm32f3xx_hal.h"
   3:Core/Src/sd_card_spi.c **** #include "sd_card_spi.h"
   4:Core/Src/sd_card_spi.c **** 
   5:Core/Src/sd_card_spi.c **** //Make sure you set #define SD_SPI_HANDLE as some hspix in main.h
   6:Core/Src/sd_card_spi.c **** //Make sure you set #define SD_CS_GPIO_Port as some GPIO port in main.h
   7:Core/Src/sd_card_spi.c **** //Make sure you set #define SD_CS_Pin as some GPIO pin in main.h
   8:Core/Src/sd_card_spi.c **** extern SPI_HandleTypeDef SD_SPI_HANDLE;
   9:Core/Src/sd_card_spi.c **** 
  10:Core/Src/sd_card_spi.c **** /* Function prototypes */
  11:Core/Src/sd_card_spi.c **** 
  12:Core/Src/sd_card_spi.c **** //(Note that the _256 is used as a mask to clear the prescalar bits as it provides binary 111 in th
  13:Core/Src/sd_card_spi.c **** #define FCLK_SLOW() { MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRA
  14:Core/Src/sd_card_spi.c **** #define FCLK_FAST() { MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRA
  15:Core/Src/sd_card_spi.c **** 
  16:Core/Src/sd_card_spi.c **** #define CS_HIGH()	{HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_SET);}
  17:Core/Src/sd_card_spi.c **** #define CS_LOW()	{HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_RESET);}
  18:Core/Src/sd_card_spi.c **** 
  19:Core/Src/sd_card_spi.c **** /* MMC/SD command */
  20:Core/Src/sd_card_spi.c **** #define CMD0	(0)			/* GO_IDLE_STATE */
  21:Core/Src/sd_card_spi.c **** #define CMD1	(1)			/* SEND_OP_COND (MMC) */
  22:Core/Src/sd_card_spi.c **** #define	ACMD41	(0x80+41)	/* SEND_OP_COND (SDC) */
  23:Core/Src/sd_card_spi.c **** #define CMD8	(8)			/* SEND_IF_COND */
  24:Core/Src/sd_card_spi.c **** #define CMD9	(9)			/* SEND_CSD */
  25:Core/Src/sd_card_spi.c **** #define CMD10	(10)		/* SEND_CID */
  26:Core/Src/sd_card_spi.c **** #define CMD12	(12)		/* STOP_TRANSMISSION */
  27:Core/Src/sd_card_spi.c **** #define ACMD13	(0x80+13)	/* SD_STATUS (SDC) */
  28:Core/Src/sd_card_spi.c **** #define CMD16	(16)		/* SET_BLOCKLEN */
  29:Core/Src/sd_card_spi.c **** #define CMD17	(17)		/* READ_SINGLE_BLOCK */
  30:Core/Src/sd_card_spi.c **** #define CMD18	(18)		/* READ_MULTIPLE_BLOCK */
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 2


  31:Core/Src/sd_card_spi.c **** #define CMD23	(23)		/* SET_BLOCK_COUNT (MMC) */
  32:Core/Src/sd_card_spi.c **** #define	ACMD23	(0x80+23)	/* SET_WR_BLK_ERASE_COUNT (SDC) */
  33:Core/Src/sd_card_spi.c **** #define CMD24	(24)		/* WRITE_BLOCK */
  34:Core/Src/sd_card_spi.c **** #define CMD25	(25)		/* WRITE_MULTIPLE_BLOCK */
  35:Core/Src/sd_card_spi.c **** #define CMD32	(32)		/* ERASE_ER_BLK_START */
  36:Core/Src/sd_card_spi.c **** #define CMD33	(33)		/* ERASE_ER_BLK_END */
  37:Core/Src/sd_card_spi.c **** #define CMD38	(38)		/* ERASE */
  38:Core/Src/sd_card_spi.c **** #define CMD55	(55)		/* APP_CMD */
  39:Core/Src/sd_card_spi.c **** #define CMD58	(58)		/* READ_OCR */
  40:Core/Src/sd_card_spi.c **** 
  41:Core/Src/sd_card_spi.c **** /* MMC card type flags (MMC_GET_TYPE) */
  42:Core/Src/sd_card_spi.c **** #define CT_MMC		0x01		/* MMC ver 3 */
  43:Core/Src/sd_card_spi.c **** #define CT_SD1		0x02		/* SD ver 1 */
  44:Core/Src/sd_card_spi.c **** #define CT_SD2		0x04		/* SD ver 2 */
  45:Core/Src/sd_card_spi.c **** #define CT_SDC		(CT_SD1|CT_SD2)	/* SD */
  46:Core/Src/sd_card_spi.c **** #define CT_BLOCK	0x08		/* Block addressing */
  47:Core/Src/sd_card_spi.c **** 
  48:Core/Src/sd_card_spi.c **** 
  49:Core/Src/sd_card_spi.c **** static volatile
  50:Core/Src/sd_card_spi.c **** DSTATUS Stat = STA_NOINIT;	/* Physical drive status */
  51:Core/Src/sd_card_spi.c **** 
  52:Core/Src/sd_card_spi.c **** 
  53:Core/Src/sd_card_spi.c **** static
  54:Core/Src/sd_card_spi.c **** BYTE CardType;			/* Card type flags */
  55:Core/Src/sd_card_spi.c **** 
  56:Core/Src/sd_card_spi.c **** uint32_t spiTimerTickStart;
  57:Core/Src/sd_card_spi.c **** uint32_t spiTimerTickDelay;
  58:Core/Src/sd_card_spi.c **** 
  59:Core/Src/sd_card_spi.c **** void SPI_Timer_On(uint32_t waitTicks) {
  60:Core/Src/sd_card_spi.c ****     spiTimerTickStart = HAL_GetTick();
  61:Core/Src/sd_card_spi.c ****     spiTimerTickDelay = waitTicks;
  62:Core/Src/sd_card_spi.c **** }
  63:Core/Src/sd_card_spi.c **** 
  64:Core/Src/sd_card_spi.c **** uint8_t SPI_Timer_Status() {
  65:Core/Src/sd_card_spi.c ****     return ((HAL_GetTick() - spiTimerTickStart) < spiTimerTickDelay);
  66:Core/Src/sd_card_spi.c **** }
  67:Core/Src/sd_card_spi.c **** 
  68:Core/Src/sd_card_spi.c **** 
  69:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
  70:Core/Src/sd_card_spi.c **** /* SPI controls (Platform dependent)                                     */
  71:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
  72:Core/Src/sd_card_spi.c **** 
  73:Core/Src/sd_card_spi.c **** /* Exchange a byte */
  74:Core/Src/sd_card_spi.c **** static BYTE xchg_spi(BYTE dat){
  29              		.loc 1 74 31 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 16
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		.loc 1 74 31 is_stmt 0 view .LVU1
  34 0000 00B5     		push	{lr}
  35              		.cfi_def_cfa_offset 4
  36              		.cfi_offset 14, -4
  37 0002 87B0     		sub	sp, sp, #28
  38              		.cfi_def_cfa_offset 32
  39 0004 8DF80F00 		strb	r0, [sp, #15]
  75:Core/Src/sd_card_spi.c ****     BYTE rxDat;
  40              		.loc 1 75 5 is_stmt 1 view .LVU2
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 3


  76:Core/Src/sd_card_spi.c ****     HAL_SPI_TransmitReceive(&SD_SPI_HANDLE, &dat, &rxDat, 1, 50);
  41              		.loc 1 76 5 view .LVU3
  42 0008 3223     		movs	r3, #50
  43 000a 0093     		str	r3, [sp]
  44 000c 0123     		movs	r3, #1
  45 000e 0DF11702 		add	r2, sp, #23
  46 0012 0DF10F01 		add	r1, sp, #15
  47 0016 0448     		ldr	r0, .L3
  48              	.LVL1:
  49              		.loc 1 76 5 is_stmt 0 view .LVU4
  50 0018 FFF7FEFF 		bl	HAL_SPI_TransmitReceive
  51              	.LVL2:
  77:Core/Src/sd_card_spi.c ****     return rxDat;
  52              		.loc 1 77 5 is_stmt 1 view .LVU5
  78:Core/Src/sd_card_spi.c **** }
  53              		.loc 1 78 1 is_stmt 0 view .LVU6
  54 001c 9DF81700 		ldrb	r0, [sp, #23]	@ zero_extendqisi2
  55 0020 07B0     		add	sp, sp, #28
  56              		.cfi_def_cfa_offset 4
  57              		@ sp needed
  58 0022 5DF804FB 		ldr	pc, [sp], #4
  59              	.L4:
  60 0026 00BF     		.align	2
  61              	.L3:
  62 0028 00000000 		.word	hspi1
  63              		.cfi_endproc
  64              	.LFE125:
  66              		.section	.text.wait_ready,"ax",%progbits
  67              		.align	1
  68              		.syntax unified
  69              		.thumb
  70              		.thumb_func
  72              	wait_ready:
  73              	.LVL3:
  74              	.LFB128:
  79:Core/Src/sd_card_spi.c **** 
  80:Core/Src/sd_card_spi.c **** /** Receive multiple byte
  81:Core/Src/sd_card_spi.c ****  * buff: Pointer to data buffer 
  82:Core/Src/sd_card_spi.c ****  * btr: Number of bytes to receive (even number)
  83:Core/Src/sd_card_spi.c ****  */
  84:Core/Src/sd_card_spi.c **** static void rcvr_spi_multi (BYTE *buff, UINT btr){
  85:Core/Src/sd_card_spi.c **** 	for(UINT i=0; i<btr; i++) {
  86:Core/Src/sd_card_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
  87:Core/Src/sd_card_spi.c **** 	}
  88:Core/Src/sd_card_spi.c **** }
  89:Core/Src/sd_card_spi.c **** 
  90:Core/Src/sd_card_spi.c **** 
  91:Core/Src/sd_card_spi.c **** #if _USE_WRITE
  92:Core/Src/sd_card_spi.c **** /* Send multiple byte */
  93:Core/Src/sd_card_spi.c **** static void xmit_spi_multi (const BYTE *buff, UINT btx){
  94:Core/Src/sd_card_spi.c ****     for(UINT i=0; i<btx; i++) {
  95:Core/Src/sd_card_spi.c **** 		xchg_spi(*(buff+i));
  96:Core/Src/sd_card_spi.c **** 	}
  97:Core/Src/sd_card_spi.c **** }
  98:Core/Src/sd_card_spi.c **** #endif
  99:Core/Src/sd_card_spi.c **** 
 100:Core/Src/sd_card_spi.c **** 
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 4


 101:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 102:Core/Src/sd_card_spi.c **** /* Wait for card ready                                                   */
 103:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 104:Core/Src/sd_card_spi.c **** 
 105:Core/Src/sd_card_spi.c **** static int wait_ready(UINT wt){
  75              		.loc 1 105 31 is_stmt 1 view -0
  76              		.cfi_startproc
  77              		@ args = 0, pretend = 0, frame = 0
  78              		@ frame_needed = 0, uses_anonymous_args = 0
  79              		.loc 1 105 31 is_stmt 0 view .LVU8
  80 0000 70B5     		push	{r4, r5, r6, lr}
  81              		.cfi_def_cfa_offset 16
  82              		.cfi_offset 4, -16
  83              		.cfi_offset 5, -12
  84              		.cfi_offset 6, -8
  85              		.cfi_offset 14, -4
  86 0002 0646     		mov	r6, r0
 106:Core/Src/sd_card_spi.c ****     BYTE d;
  87              		.loc 1 106 5 is_stmt 1 view .LVU9
 107:Core/Src/sd_card_spi.c **** 	//wait_ready needs its own timer, unfortunately, so it can't use the
 108:Core/Src/sd_card_spi.c **** 	//spi_timer functions
 109:Core/Src/sd_card_spi.c **** 	uint32_t waitSpiTimerTickStart;
  88              		.loc 1 109 2 view .LVU10
 110:Core/Src/sd_card_spi.c **** 	uint32_t waitSpiTimerTickDelay;
  89              		.loc 1 110 2 view .LVU11
 111:Core/Src/sd_card_spi.c **** 
 112:Core/Src/sd_card_spi.c **** 	waitSpiTimerTickStart = HAL_GetTick();
  90              		.loc 1 112 2 view .LVU12
  91              		.loc 1 112 26 is_stmt 0 view .LVU13
  92 0004 FFF7FEFF 		bl	HAL_GetTick
  93              	.LVL4:
  94              		.loc 1 112 26 view .LVU14
  95 0008 0546     		mov	r5, r0
  96              	.LVL5:
 113:Core/Src/sd_card_spi.c **** 	waitSpiTimerTickDelay = (uint32_t)wt;
  97              		.loc 1 113 2 is_stmt 1 view .LVU15
  98              	.L7:
 114:Core/Src/sd_card_spi.c **** 	do {
  99              		.loc 1 114 2 discriminator 2 view .LVU16
 115:Core/Src/sd_card_spi.c **** 		d = xchg_spi(0xFF);
 100              		.loc 1 115 3 discriminator 2 view .LVU17
 101              		.loc 1 115 7 is_stmt 0 discriminator 2 view .LVU18
 102 000a FF20     		movs	r0, #255
 103 000c FFF7FEFF 		bl	xchg_spi
 104              	.LVL6:
 105 0010 0446     		mov	r4, r0
 106              	.LVL7:
 116:Core/Src/sd_card_spi.c **** 		/* This loop takes a time. Insert rot_rdq() here for multitask envilonment. */
 117:Core/Src/sd_card_spi.c **** 	} while (d != 0xFF && ((HAL_GetTick() - waitSpiTimerTickStart) < waitSpiTimerTickDelay));	/* Wait 
 107              		.loc 1 117 21 is_stmt 1 discriminator 2 view .LVU19
 108 0012 FF28     		cmp	r0, #255
 109 0014 04D0     		beq	.L6
 110              		.loc 1 117 26 is_stmt 0 discriminator 1 view .LVU20
 111 0016 FFF7FEFF 		bl	HAL_GetTick
 112              	.LVL8:
 113              		.loc 1 117 40 discriminator 1 view .LVU21
 114 001a 401B     		subs	r0, r0, r5
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 5


 115              		.loc 1 117 21 discriminator 1 view .LVU22
 116 001c B042     		cmp	r0, r6
 117 001e F4D3     		bcc	.L7
 118              	.L6:
 118:Core/Src/sd_card_spi.c **** 
 119:Core/Src/sd_card_spi.c **** 	return (d == 0xFF) ? 1 : 0;
 119              		.loc 1 119 2 is_stmt 1 view .LVU23
 120:Core/Src/sd_card_spi.c **** }
 120              		.loc 1 120 1 is_stmt 0 view .LVU24
 121 0020 FF2C     		cmp	r4, #255
 122 0022 14BF     		ite	ne
 123 0024 0020     		movne	r0, #0
 124 0026 0120     		moveq	r0, #1
 125 0028 70BD     		pop	{r4, r5, r6, pc}
 126              		.loc 1 120 1 view .LVU25
 127              		.cfi_endproc
 128              	.LFE128:
 130              		.section	.text.rcvr_spi_multi,"ax",%progbits
 131              		.align	1
 132              		.syntax unified
 133              		.thumb
 134              		.thumb_func
 136              	rcvr_spi_multi:
 137              	.LVL9:
 138              	.LFB126:
  84:Core/Src/sd_card_spi.c **** 	for(UINT i=0; i<btr; i++) {
 139              		.loc 1 84 50 is_stmt 1 view -0
 140              		.cfi_startproc
 141              		@ args = 0, pretend = 0, frame = 0
 142              		@ frame_needed = 0, uses_anonymous_args = 0
  84:Core/Src/sd_card_spi.c **** 	for(UINT i=0; i<btr; i++) {
 143              		.loc 1 84 50 is_stmt 0 view .LVU27
 144 0000 70B5     		push	{r4, r5, r6, lr}
 145              		.cfi_def_cfa_offset 16
 146              		.cfi_offset 4, -16
 147              		.cfi_offset 5, -12
 148              		.cfi_offset 6, -8
 149              		.cfi_offset 14, -4
 150 0002 0646     		mov	r6, r0
 151 0004 0D46     		mov	r5, r1
  85:Core/Src/sd_card_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 152              		.loc 1 85 2 is_stmt 1 view .LVU28
 153              	.LBB2:
  85:Core/Src/sd_card_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 154              		.loc 1 85 6 view .LVU29
 155              	.LVL10:
  85:Core/Src/sd_card_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 156              		.loc 1 85 11 is_stmt 0 view .LVU30
 157 0006 0024     		movs	r4, #0
  85:Core/Src/sd_card_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 158              		.loc 1 85 2 view .LVU31
 159 0008 04E0     		b	.L10
 160              	.LVL11:
 161              	.L11:
  86:Core/Src/sd_card_spi.c **** 	}
 162              		.loc 1 86 3 is_stmt 1 discriminator 3 view .LVU32
  86:Core/Src/sd_card_spi.c **** 	}
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 6


 163              		.loc 1 86 15 is_stmt 0 discriminator 3 view .LVU33
 164 000a FF20     		movs	r0, #255
 165 000c FFF7FEFF 		bl	xchg_spi
 166              	.LVL12:
  86:Core/Src/sd_card_spi.c **** 	}
 167              		.loc 1 86 13 discriminator 3 view .LVU34
 168 0010 3055     		strb	r0, [r6, r4]
  85:Core/Src/sd_card_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 169              		.loc 1 85 24 is_stmt 1 discriminator 3 view .LVU35
 170 0012 0134     		adds	r4, r4, #1
 171              	.LVL13:
 172              	.L10:
  85:Core/Src/sd_card_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 173              		.loc 1 85 17 discriminator 1 view .LVU36
 174 0014 AC42     		cmp	r4, r5
 175 0016 F8D3     		bcc	.L11
 176              	.LBE2:
  88:Core/Src/sd_card_spi.c **** 
 177              		.loc 1 88 1 is_stmt 0 view .LVU37
 178 0018 70BD     		pop	{r4, r5, r6, pc}
  88:Core/Src/sd_card_spi.c **** 
 179              		.loc 1 88 1 view .LVU38
 180              		.cfi_endproc
 181              	.LFE126:
 183              		.section	.text.xmit_spi_multi,"ax",%progbits
 184              		.align	1
 185              		.syntax unified
 186              		.thumb
 187              		.thumb_func
 189              	xmit_spi_multi:
 190              	.LVL14:
 191              	.LFB127:
  93:Core/Src/sd_card_spi.c ****     for(UINT i=0; i<btx; i++) {
 192              		.loc 1 93 56 is_stmt 1 view -0
 193              		.cfi_startproc
 194              		@ args = 0, pretend = 0, frame = 0
 195              		@ frame_needed = 0, uses_anonymous_args = 0
  93:Core/Src/sd_card_spi.c ****     for(UINT i=0; i<btx; i++) {
 196              		.loc 1 93 56 is_stmt 0 view .LVU40
 197 0000 70B5     		push	{r4, r5, r6, lr}
 198              		.cfi_def_cfa_offset 16
 199              		.cfi_offset 4, -16
 200              		.cfi_offset 5, -12
 201              		.cfi_offset 6, -8
 202              		.cfi_offset 14, -4
 203 0002 0646     		mov	r6, r0
 204 0004 0D46     		mov	r5, r1
  94:Core/Src/sd_card_spi.c **** 		xchg_spi(*(buff+i));
 205              		.loc 1 94 5 is_stmt 1 view .LVU41
 206              	.LBB3:
  94:Core/Src/sd_card_spi.c **** 		xchg_spi(*(buff+i));
 207              		.loc 1 94 9 view .LVU42
 208              	.LVL15:
  94:Core/Src/sd_card_spi.c **** 		xchg_spi(*(buff+i));
 209              		.loc 1 94 14 is_stmt 0 view .LVU43
 210 0006 0024     		movs	r4, #0
  94:Core/Src/sd_card_spi.c **** 		xchg_spi(*(buff+i));
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 7


 211              		.loc 1 94 5 view .LVU44
 212 0008 03E0     		b	.L14
 213              	.LVL16:
 214              	.L15:
  95:Core/Src/sd_card_spi.c **** 	}
 215              		.loc 1 95 3 is_stmt 1 discriminator 3 view .LVU45
 216 000a 305D     		ldrb	r0, [r6, r4]	@ zero_extendqisi2
 217 000c FFF7FEFF 		bl	xchg_spi
 218              	.LVL17:
  94:Core/Src/sd_card_spi.c **** 		xchg_spi(*(buff+i));
 219              		.loc 1 94 27 discriminator 3 view .LVU46
 220 0010 0134     		adds	r4, r4, #1
 221              	.LVL18:
 222              	.L14:
  94:Core/Src/sd_card_spi.c **** 		xchg_spi(*(buff+i));
 223              		.loc 1 94 20 discriminator 1 view .LVU47
 224 0012 AC42     		cmp	r4, r5
 225 0014 F9D3     		bcc	.L15
 226              	.LBE3:
  97:Core/Src/sd_card_spi.c **** #endif
 227              		.loc 1 97 1 is_stmt 0 view .LVU48
 228 0016 70BD     		pop	{r4, r5, r6, pc}
  97:Core/Src/sd_card_spi.c **** #endif
 229              		.loc 1 97 1 view .LVU49
 230              		.cfi_endproc
 231              	.LFE127:
 233              		.section	.text.xmit_datablock,"ax",%progbits
 234              		.align	1
 235              		.syntax unified
 236              		.thumb
 237              		.thumb_func
 239              	xmit_datablock:
 240              	.LVL19:
 241              	.LFB132:
 121:Core/Src/sd_card_spi.c **** 
 122:Core/Src/sd_card_spi.c **** 
 123:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 124:Core/Src/sd_card_spi.c **** /* Despiselect card and release SPI                                         */
 125:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 126:Core/Src/sd_card_spi.c **** 
 127:Core/Src/sd_card_spi.c **** static
 128:Core/Src/sd_card_spi.c **** void despiselect (void) {
 129:Core/Src/sd_card_spi.c **** 	CS_HIGH();		/* Set CS# high */
 130:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO hi-z for multiple slave SPI) */
 131:Core/Src/sd_card_spi.c **** }
 132:Core/Src/sd_card_spi.c **** 
 133:Core/Src/sd_card_spi.c **** 
 134:Core/Src/sd_card_spi.c **** 
 135:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 136:Core/Src/sd_card_spi.c **** /* Select card and wait for ready                                        */
 137:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 138:Core/Src/sd_card_spi.c **** 
 139:Core/Src/sd_card_spi.c **** static
 140:Core/Src/sd_card_spi.c **** int spiselect (void){
 141:Core/Src/sd_card_spi.c ****     CS_LOW();		/* Set CS# low */
 142:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO enabled) */
 143:Core/Src/sd_card_spi.c **** 	if (wait_ready(500)) return 1;	/* Wait for card ready */
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 8


 144:Core/Src/sd_card_spi.c **** 
 145:Core/Src/sd_card_spi.c **** 	despiselect();
 146:Core/Src/sd_card_spi.c **** 	return 0;	/* Timeout */
 147:Core/Src/sd_card_spi.c **** }
 148:Core/Src/sd_card_spi.c **** 
 149:Core/Src/sd_card_spi.c **** 
 150:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 151:Core/Src/sd_card_spi.c **** /* Receive a data packet from the MMC                                    */
 152:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 153:Core/Src/sd_card_spi.c **** static int rcvr_datablock (BYTE *buff, UINT btr){
 154:Core/Src/sd_card_spi.c ****     BYTE token;
 155:Core/Src/sd_card_spi.c **** 
 156:Core/Src/sd_card_spi.c **** 	SPI_Timer_On(200);
 157:Core/Src/sd_card_spi.c **** 	do {							/* Wait for DataStart token in timeout of 200ms */
 158:Core/Src/sd_card_spi.c **** 		token = xchg_spi(0xFF);
 159:Core/Src/sd_card_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 160:Core/Src/sd_card_spi.c **** 	} while ((token == 0xFF) && SPI_Timer_Status());
 161:Core/Src/sd_card_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 162:Core/Src/sd_card_spi.c **** 
 163:Core/Src/sd_card_spi.c **** 	rcvr_spi_multi(buff, btr);		/* Store trailing data to the buffer */
 164:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF); xchg_spi(0xFF);			/* Discard CRC */
 165:Core/Src/sd_card_spi.c **** 
 166:Core/Src/sd_card_spi.c **** 	return 1;						/* Function succeeded */
 167:Core/Src/sd_card_spi.c **** }
 168:Core/Src/sd_card_spi.c **** 
 169:Core/Src/sd_card_spi.c **** 
 170:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 171:Core/Src/sd_card_spi.c **** /* Send a data packet to the MMC                                         */
 172:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 173:Core/Src/sd_card_spi.c **** 
 174:Core/Src/sd_card_spi.c **** #if _USE_WRITE
 175:Core/Src/sd_card_spi.c **** static int xmit_datablock (const BYTE *buff, BYTE token){
 242              		.loc 1 175 57 is_stmt 1 view -0
 243              		.cfi_startproc
 244              		@ args = 0, pretend = 0, frame = 0
 245              		@ frame_needed = 0, uses_anonymous_args = 0
 246              		.loc 1 175 57 is_stmt 0 view .LVU51
 247 0000 38B5     		push	{r3, r4, r5, lr}
 248              		.cfi_def_cfa_offset 16
 249              		.cfi_offset 3, -16
 250              		.cfi_offset 4, -12
 251              		.cfi_offset 5, -8
 252              		.cfi_offset 14, -4
 253 0002 0546     		mov	r5, r0
 254 0004 0C46     		mov	r4, r1
 176:Core/Src/sd_card_spi.c **** 	BYTE resp;
 255              		.loc 1 176 2 is_stmt 1 view .LVU52
 177:Core/Src/sd_card_spi.c **** 
 178:Core/Src/sd_card_spi.c **** 	if (!wait_ready(500)) return 0;		/* Wait for card ready */
 256              		.loc 1 178 2 view .LVU53
 257              		.loc 1 178 7 is_stmt 0 view .LVU54
 258 0006 4FF4FA70 		mov	r0, #500
 259              	.LVL20:
 260              		.loc 1 178 7 view .LVU55
 261 000a FFF7FEFF 		bl	wait_ready
 262              	.LVL21:
 263              		.loc 1 178 5 view .LVU56
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 9


 264 000e 00B9     		cbnz	r0, .L22
 265              	.L17:
 179:Core/Src/sd_card_spi.c **** 
 180:Core/Src/sd_card_spi.c **** 	xchg_spi(token);					/* Send token */
 181:Core/Src/sd_card_spi.c **** 	if (token != 0xFD) {				/* Send data if token is other than StopTran */
 182:Core/Src/sd_card_spi.c **** 		xmit_spi_multi(buff, 512);		/* Data */
 183:Core/Src/sd_card_spi.c **** 		xchg_spi(0xFF); xchg_spi(0xFF);	/* Dummy CRC */
 184:Core/Src/sd_card_spi.c **** 
 185:Core/Src/sd_card_spi.c **** 		resp = xchg_spi(0xFF);				/* Receive data resp */
 186:Core/Src/sd_card_spi.c **** 		if ((resp & 0x1F) != 0x05) return 0;	/* Function fails if the data packet was not accepted */
 187:Core/Src/sd_card_spi.c **** 	}
 188:Core/Src/sd_card_spi.c **** 	return 1;
 189:Core/Src/sd_card_spi.c **** }
 266              		.loc 1 189 1 view .LVU57
 267 0010 38BD     		pop	{r3, r4, r5, pc}
 268              	.LVL22:
 269              	.L22:
 180:Core/Src/sd_card_spi.c **** 	if (token != 0xFD) {				/* Send data if token is other than StopTran */
 270              		.loc 1 180 2 is_stmt 1 view .LVU58
 271 0012 2046     		mov	r0, r4
 272 0014 FFF7FEFF 		bl	xchg_spi
 273              	.LVL23:
 181:Core/Src/sd_card_spi.c **** 		xmit_spi_multi(buff, 512);		/* Data */
 274              		.loc 1 181 2 view .LVU59
 181:Core/Src/sd_card_spi.c **** 		xmit_spi_multi(buff, 512);		/* Data */
 275              		.loc 1 181 5 is_stmt 0 view .LVU60
 276 0018 FD2C     		cmp	r4, #253
 277 001a 01D1     		bne	.L23
 188:Core/Src/sd_card_spi.c **** }
 278              		.loc 1 188 9 view .LVU61
 279 001c 0120     		movs	r0, #1
 280 001e F7E7     		b	.L17
 281              	.L23:
 182:Core/Src/sd_card_spi.c **** 		xchg_spi(0xFF); xchg_spi(0xFF);	/* Dummy CRC */
 282              		.loc 1 182 3 is_stmt 1 view .LVU62
 283 0020 4FF40071 		mov	r1, #512
 284 0024 2846     		mov	r0, r5
 285 0026 FFF7FEFF 		bl	xmit_spi_multi
 286              	.LVL24:
 183:Core/Src/sd_card_spi.c **** 
 287              		.loc 1 183 3 view .LVU63
 288 002a FF20     		movs	r0, #255
 289 002c FFF7FEFF 		bl	xchg_spi
 290              	.LVL25:
 183:Core/Src/sd_card_spi.c **** 
 291              		.loc 1 183 19 view .LVU64
 292 0030 FF20     		movs	r0, #255
 293 0032 FFF7FEFF 		bl	xchg_spi
 294              	.LVL26:
 185:Core/Src/sd_card_spi.c **** 		if ((resp & 0x1F) != 0x05) return 0;	/* Function fails if the data packet was not accepted */
 295              		.loc 1 185 3 view .LVU65
 185:Core/Src/sd_card_spi.c **** 		if ((resp & 0x1F) != 0x05) return 0;	/* Function fails if the data packet was not accepted */
 296              		.loc 1 185 10 is_stmt 0 view .LVU66
 297 0036 FF20     		movs	r0, #255
 298 0038 FFF7FEFF 		bl	xchg_spi
 299              	.LVL27:
 186:Core/Src/sd_card_spi.c **** 	}
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 10


 300              		.loc 1 186 3 is_stmt 1 view .LVU67
 186:Core/Src/sd_card_spi.c **** 	}
 301              		.loc 1 186 6 is_stmt 0 view .LVU68
 302 003c 00F01F00 		and	r0, r0, #31
 303              	.LVL28:
 186:Core/Src/sd_card_spi.c **** 	}
 304              		.loc 1 186 6 view .LVU69
 305 0040 0528     		cmp	r0, #5
 306 0042 01D1     		bne	.L20
 188:Core/Src/sd_card_spi.c **** }
 307              		.loc 1 188 9 view .LVU70
 308 0044 0120     		movs	r0, #1
 309 0046 E3E7     		b	.L17
 310              	.L20:
 186:Core/Src/sd_card_spi.c **** 	}
 311              		.loc 1 186 37 view .LVU71
 312 0048 0020     		movs	r0, #0
 313 004a E1E7     		b	.L17
 314              		.cfi_endproc
 315              	.LFE132:
 317              		.section	.text.despiselect,"ax",%progbits
 318              		.align	1
 319              		.syntax unified
 320              		.thumb
 321              		.thumb_func
 323              	despiselect:
 324              	.LFB129:
 128:Core/Src/sd_card_spi.c **** 	CS_HIGH();		/* Set CS# high */
 325              		.loc 1 128 25 is_stmt 1 view -0
 326              		.cfi_startproc
 327              		@ args = 0, pretend = 0, frame = 0
 328              		@ frame_needed = 0, uses_anonymous_args = 0
 329 0000 08B5     		push	{r3, lr}
 330              		.cfi_def_cfa_offset 8
 331              		.cfi_offset 3, -8
 332              		.cfi_offset 14, -4
 129:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO hi-z for multiple slave SPI) */
 333              		.loc 1 129 2 view .LVU73
 334 0002 0122     		movs	r2, #1
 335 0004 0421     		movs	r1, #4
 336 0006 0348     		ldr	r0, .L26
 337 0008 FFF7FEFF 		bl	HAL_GPIO_WritePin
 338              	.LVL29:
 129:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO hi-z for multiple slave SPI) */
 339              		.loc 1 129 11 view .LVU74
 130:Core/Src/sd_card_spi.c **** }
 340              		.loc 1 130 2 view .LVU75
 341 000c FF20     		movs	r0, #255
 342 000e FFF7FEFF 		bl	xchg_spi
 343              	.LVL30:
 131:Core/Src/sd_card_spi.c **** 
 344              		.loc 1 131 1 is_stmt 0 view .LVU76
 345 0012 08BD     		pop	{r3, pc}
 346              	.L27:
 347              		.align	2
 348              	.L26:
 349 0014 00040048 		.word	1207960576
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 11


 350              		.cfi_endproc
 351              	.LFE129:
 353              		.section	.text.spiselect,"ax",%progbits
 354              		.align	1
 355              		.syntax unified
 356              		.thumb
 357              		.thumb_func
 359              	spiselect:
 360              	.LFB130:
 140:Core/Src/sd_card_spi.c ****     CS_LOW();		/* Set CS# low */
 361              		.loc 1 140 21 is_stmt 1 view -0
 362              		.cfi_startproc
 363              		@ args = 0, pretend = 0, frame = 0
 364              		@ frame_needed = 0, uses_anonymous_args = 0
 365 0000 10B5     		push	{r4, lr}
 366              		.cfi_def_cfa_offset 8
 367              		.cfi_offset 4, -8
 368              		.cfi_offset 14, -4
 141:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO enabled) */
 369              		.loc 1 141 5 view .LVU78
 370 0002 0022     		movs	r2, #0
 371 0004 0421     		movs	r1, #4
 372 0006 0948     		ldr	r0, .L33
 373 0008 FFF7FEFF 		bl	HAL_GPIO_WritePin
 374              	.LVL31:
 141:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO enabled) */
 375              		.loc 1 141 13 view .LVU79
 142:Core/Src/sd_card_spi.c **** 	if (wait_ready(500)) return 1;	/* Wait for card ready */
 376              		.loc 1 142 2 view .LVU80
 377 000c FF20     		movs	r0, #255
 378 000e FFF7FEFF 		bl	xchg_spi
 379              	.LVL32:
 143:Core/Src/sd_card_spi.c **** 
 380              		.loc 1 143 2 view .LVU81
 143:Core/Src/sd_card_spi.c **** 
 381              		.loc 1 143 6 is_stmt 0 view .LVU82
 382 0012 4FF4FA70 		mov	r0, #500
 383 0016 FFF7FEFF 		bl	wait_ready
 384              	.LVL33:
 143:Core/Src/sd_card_spi.c **** 
 385              		.loc 1 143 5 view .LVU83
 386 001a 10B1     		cbz	r0, .L32
 143:Core/Src/sd_card_spi.c **** 
 387              		.loc 1 143 30 view .LVU84
 388 001c 0124     		movs	r4, #1
 389              	.L28:
 147:Core/Src/sd_card_spi.c **** 
 390              		.loc 1 147 1 view .LVU85
 391 001e 2046     		mov	r0, r4
 392 0020 10BD     		pop	{r4, pc}
 393              	.L32:
 394 0022 0446     		mov	r4, r0
 145:Core/Src/sd_card_spi.c **** 	return 0;	/* Timeout */
 395              		.loc 1 145 2 is_stmt 1 view .LVU86
 396 0024 FFF7FEFF 		bl	despiselect
 397              	.LVL34:
 146:Core/Src/sd_card_spi.c **** }
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 12


 398              		.loc 1 146 2 view .LVU87
 146:Core/Src/sd_card_spi.c **** }
 399              		.loc 1 146 9 is_stmt 0 view .LVU88
 400 0028 F9E7     		b	.L28
 401              	.L34:
 402 002a 00BF     		.align	2
 403              	.L33:
 404 002c 00040048 		.word	1207960576
 405              		.cfi_endproc
 406              	.LFE130:
 408              		.section	.text.send_cmd,"ax",%progbits
 409              		.align	1
 410              		.syntax unified
 411              		.thumb
 412              		.thumb_func
 414              	send_cmd:
 415              	.LVL35:
 416              	.LFB133:
 190:Core/Src/sd_card_spi.c **** #endif
 191:Core/Src/sd_card_spi.c **** 
 192:Core/Src/sd_card_spi.c **** 
 193:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 194:Core/Src/sd_card_spi.c **** /* Send a command packet to the MMC                                      */
 195:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 196:Core/Src/sd_card_spi.c **** 
 197:Core/Src/sd_card_spi.c **** static BYTE send_cmd (BYTE cmd, DWORD arg){
 417              		.loc 1 197 43 is_stmt 1 view -0
 418              		.cfi_startproc
 419              		@ args = 0, pretend = 0, frame = 0
 420              		@ frame_needed = 0, uses_anonymous_args = 0
 421              		.loc 1 197 43 is_stmt 0 view .LVU90
 422 0000 38B5     		push	{r3, r4, r5, lr}
 423              		.cfi_def_cfa_offset 16
 424              		.cfi_offset 3, -16
 425              		.cfi_offset 4, -12
 426              		.cfi_offset 5, -8
 427              		.cfi_offset 14, -4
 428 0002 0446     		mov	r4, r0
 429 0004 0D46     		mov	r5, r1
 198:Core/Src/sd_card_spi.c **** 	BYTE n, res;
 430              		.loc 1 198 2 is_stmt 1 view .LVU91
 199:Core/Src/sd_card_spi.c **** 
 200:Core/Src/sd_card_spi.c **** 	if (cmd & 0x80) {	/* Send a CMD55 prior to ACMD<n> */
 431              		.loc 1 200 2 view .LVU92
 432              		.loc 1 200 5 is_stmt 0 view .LVU93
 433 0006 10F0800F 		tst	r0, #128
 434 000a 1DD1     		bne	.L46
 435              	.LVL36:
 436              	.L36:
 201:Core/Src/sd_card_spi.c **** 		cmd &= 0x7F;
 202:Core/Src/sd_card_spi.c **** 		res = send_cmd(CMD55, 0);
 203:Core/Src/sd_card_spi.c **** 		if (res > 1) return res;
 204:Core/Src/sd_card_spi.c **** 	}
 205:Core/Src/sd_card_spi.c **** 
 206:Core/Src/sd_card_spi.c **** 	/* Select the card and wait for ready except to stop multiple block read */
 207:Core/Src/sd_card_spi.c **** 	if (cmd != CMD12) {
 437              		.loc 1 207 2 is_stmt 1 view .LVU94
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 13


 438              		.loc 1 207 5 is_stmt 0 view .LVU95
 439 000c 0C2C     		cmp	r4, #12
 440 000e 04D0     		beq	.L38
 208:Core/Src/sd_card_spi.c **** 		despiselect();
 441              		.loc 1 208 3 is_stmt 1 view .LVU96
 442 0010 FFF7FEFF 		bl	despiselect
 443              	.LVL37:
 209:Core/Src/sd_card_spi.c **** 		if (!spiselect()) return 0xFF;
 444              		.loc 1 209 3 view .LVU97
 445              		.loc 1 209 8 is_stmt 0 view .LVU98
 446 0014 FFF7FEFF 		bl	spiselect
 447              	.LVL38:
 448              		.loc 1 209 6 view .LVU99
 449 0018 B0B3     		cbz	r0, .L42
 450              	.L38:
 210:Core/Src/sd_card_spi.c **** 	}
 211:Core/Src/sd_card_spi.c **** 
 212:Core/Src/sd_card_spi.c **** 	/* Send command packet */
 213:Core/Src/sd_card_spi.c **** 	xchg_spi(0x40 | cmd);				/* Start + command index */
 451              		.loc 1 213 2 is_stmt 1 view .LVU100
 452 001a 44F04000 		orr	r0, r4, #64
 453 001e FFF7FEFF 		bl	xchg_spi
 454              	.LVL39:
 214:Core/Src/sd_card_spi.c **** 	xchg_spi((BYTE)(arg >> 24));		/* Argument[31..24] */
 455              		.loc 1 214 2 view .LVU101
 456 0022 280E     		lsrs	r0, r5, #24
 457 0024 FFF7FEFF 		bl	xchg_spi
 458              	.LVL40:
 215:Core/Src/sd_card_spi.c **** 	xchg_spi((BYTE)(arg >> 16));		/* Argument[23..16] */
 459              		.loc 1 215 2 view .LVU102
 460 0028 C5F30740 		ubfx	r0, r5, #16, #8
 461 002c FFF7FEFF 		bl	xchg_spi
 462              	.LVL41:
 216:Core/Src/sd_card_spi.c **** 	xchg_spi((BYTE)(arg >> 8));			/* Argument[15..8] */
 463              		.loc 1 216 2 view .LVU103
 464 0030 C5F30720 		ubfx	r0, r5, #8, #8
 465 0034 FFF7FEFF 		bl	xchg_spi
 466              	.LVL42:
 217:Core/Src/sd_card_spi.c **** 	xchg_spi((BYTE)arg);				/* Argument[7..0] */
 467              		.loc 1 217 2 view .LVU104
 468 0038 E8B2     		uxtb	r0, r5
 469 003a FFF7FEFF 		bl	xchg_spi
 470              	.LVL43:
 218:Core/Src/sd_card_spi.c **** 	n = 0x01;							/* Dummy CRC + Stop */
 471              		.loc 1 218 2 view .LVU105
 219:Core/Src/sd_card_spi.c **** 	if (cmd == CMD0) n = 0x95;			/* Valid CRC for CMD0(0) */
 472              		.loc 1 219 2 view .LVU106
 473              		.loc 1 219 5 is_stmt 0 view .LVU107
 474 003e 64B1     		cbz	r4, .L43
 220:Core/Src/sd_card_spi.c **** 	if (cmd == CMD8) n = 0x87;			/* Valid CRC for CMD8(0x1AA) */
 475              		.loc 1 220 2 is_stmt 1 view .LVU108
 476              		.loc 1 220 5 is_stmt 0 view .LVU109
 477 0040 082C     		cmp	r4, #8
 478 0042 1BD0     		beq	.L44
 218:Core/Src/sd_card_spi.c **** 	n = 0x01;							/* Dummy CRC + Stop */
 479              		.loc 1 218 4 view .LVU110
 480 0044 0120     		movs	r0, #1
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 14


 481 0046 09E0     		b	.L39
 482              	.LVL44:
 483              	.L46:
 201:Core/Src/sd_card_spi.c **** 		res = send_cmd(CMD55, 0);
 484              		.loc 1 201 3 is_stmt 1 view .LVU111
 201:Core/Src/sd_card_spi.c **** 		res = send_cmd(CMD55, 0);
 485              		.loc 1 201 7 is_stmt 0 view .LVU112
 486 0048 00F07F04 		and	r4, r0, #127
 487              	.LVL45:
 202:Core/Src/sd_card_spi.c **** 		if (res > 1) return res;
 488              		.loc 1 202 3 is_stmt 1 view .LVU113
 202:Core/Src/sd_card_spi.c **** 		if (res > 1) return res;
 489              		.loc 1 202 9 is_stmt 0 view .LVU114
 490 004c 0021     		movs	r1, #0
 491              	.LVL46:
 202:Core/Src/sd_card_spi.c **** 		if (res > 1) return res;
 492              		.loc 1 202 9 view .LVU115
 493 004e 3720     		movs	r0, #55
 494 0050 FFF7D6FF 		bl	send_cmd
 495              	.LVL47:
 203:Core/Src/sd_card_spi.c **** 	}
 496              		.loc 1 203 3 is_stmt 1 view .LVU116
 203:Core/Src/sd_card_spi.c **** 	}
 497              		.loc 1 203 6 is_stmt 0 view .LVU117
 498 0054 0128     		cmp	r0, #1
 499 0056 D9D9     		bls	.L36
 500 0058 0FE0     		b	.L37
 501              	.LVL48:
 502              	.L43:
 219:Core/Src/sd_card_spi.c **** 	if (cmd == CMD8) n = 0x87;			/* Valid CRC for CMD8(0x1AA) */
 503              		.loc 1 219 21 view .LVU118
 504 005a 9520     		movs	r0, #149
 505              	.L39:
 506              	.LVL49:
 221:Core/Src/sd_card_spi.c **** 	xchg_spi(n);
 507              		.loc 1 221 2 is_stmt 1 view .LVU119
 508 005c FFF7FEFF 		bl	xchg_spi
 509              	.LVL50:
 222:Core/Src/sd_card_spi.c **** 
 223:Core/Src/sd_card_spi.c **** 	/* Receive command resp */
 224:Core/Src/sd_card_spi.c **** 	if (cmd == CMD12) xchg_spi(0xFF);	/* Diacard following one byte when CMD12 */
 510              		.loc 1 224 2 view .LVU120
 511              		.loc 1 224 5 is_stmt 0 view .LVU121
 512 0060 0C2C     		cmp	r4, #12
 513 0062 0DD0     		beq	.L47
 514              	.L40:
 219:Core/Src/sd_card_spi.c **** 	if (cmd == CMD8) n = 0x87;			/* Valid CRC for CMD8(0x1AA) */
 515              		.loc 1 219 21 discriminator 2 view .LVU122
 516 0064 0A24     		movs	r4, #10
 517              	.LVL51:
 518              	.L41:
 225:Core/Src/sd_card_spi.c **** 	n = 10;								/* Wait for response (10 bytes max) */
 226:Core/Src/sd_card_spi.c **** 	do {
 519              		.loc 1 226 2 is_stmt 1 discriminator 2 view .LVU123
 227:Core/Src/sd_card_spi.c **** 		res = xchg_spi(0xFF);
 520              		.loc 1 227 3 discriminator 2 view .LVU124
 521              		.loc 1 227 9 is_stmt 0 discriminator 2 view .LVU125
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 15


 522 0066 FF20     		movs	r0, #255
 523 0068 FFF7FEFF 		bl	xchg_spi
 524              	.LVL52:
 228:Core/Src/sd_card_spi.c **** 	} while ((res & 0x80) && --n);
 525              		.loc 1 228 24 is_stmt 1 discriminator 2 view .LVU126
 526 006c 10F0800F 		tst	r0, #128
 527 0070 03D0     		beq	.L37
 528              		.loc 1 228 24 is_stmt 0 discriminator 1 view .LVU127
 529 0072 631E     		subs	r3, r4, #1
 530              	.LVL53:
 531              		.loc 1 228 24 discriminator 1 view .LVU128
 532 0074 13F0FF04 		ands	r4, r3, #255
 533 0078 F5D1     		bne	.L41
 534              	.LVL54:
 535              	.L37:
 229:Core/Src/sd_card_spi.c **** 
 230:Core/Src/sd_card_spi.c **** 	return res;							/* Return received response */
 231:Core/Src/sd_card_spi.c **** }
 536              		.loc 1 231 1 view .LVU129
 537 007a 38BD     		pop	{r3, r4, r5, pc}
 538              	.LVL55:
 539              	.L44:
 220:Core/Src/sd_card_spi.c **** 	xchg_spi(n);
 540              		.loc 1 220 21 view .LVU130
 541 007c 8720     		movs	r0, #135
 542 007e EDE7     		b	.L39
 543              	.LVL56:
 544              	.L47:
 224:Core/Src/sd_card_spi.c **** 	n = 10;								/* Wait for response (10 bytes max) */
 545              		.loc 1 224 20 is_stmt 1 discriminator 1 view .LVU131
 546 0080 FF20     		movs	r0, #255
 547 0082 FFF7FEFF 		bl	xchg_spi
 548              	.LVL57:
 549 0086 EDE7     		b	.L40
 550              	.LVL58:
 551              	.L42:
 209:Core/Src/sd_card_spi.c **** 	}
 552              		.loc 1 209 28 is_stmt 0 view .LVU132
 553 0088 FF20     		movs	r0, #255
 554 008a F6E7     		b	.L37
 555              		.cfi_endproc
 556              	.LFE133:
 558              		.section	.text.SPI_Timer_On,"ax",%progbits
 559              		.align	1
 560              		.global	SPI_Timer_On
 561              		.syntax unified
 562              		.thumb
 563              		.thumb_func
 565              	SPI_Timer_On:
 566              	.LVL59:
 567              	.LFB123:
  59:Core/Src/sd_card_spi.c ****     spiTimerTickStart = HAL_GetTick();
 568              		.loc 1 59 39 is_stmt 1 view -0
 569              		.cfi_startproc
 570              		@ args = 0, pretend = 0, frame = 0
 571              		@ frame_needed = 0, uses_anonymous_args = 0
  59:Core/Src/sd_card_spi.c ****     spiTimerTickStart = HAL_GetTick();
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 16


 572              		.loc 1 59 39 is_stmt 0 view .LVU134
 573 0000 10B5     		push	{r4, lr}
 574              		.cfi_def_cfa_offset 8
 575              		.cfi_offset 4, -8
 576              		.cfi_offset 14, -4
 577 0002 0446     		mov	r4, r0
  60:Core/Src/sd_card_spi.c ****     spiTimerTickDelay = waitTicks;
 578              		.loc 1 60 5 is_stmt 1 view .LVU135
  60:Core/Src/sd_card_spi.c ****     spiTimerTickDelay = waitTicks;
 579              		.loc 1 60 25 is_stmt 0 view .LVU136
 580 0004 FFF7FEFF 		bl	HAL_GetTick
 581              	.LVL60:
  60:Core/Src/sd_card_spi.c ****     spiTimerTickDelay = waitTicks;
 582              		.loc 1 60 23 view .LVU137
 583 0008 024B     		ldr	r3, .L50
 584 000a 1860     		str	r0, [r3]
  61:Core/Src/sd_card_spi.c **** }
 585              		.loc 1 61 5 is_stmt 1 view .LVU138
  61:Core/Src/sd_card_spi.c **** }
 586              		.loc 1 61 23 is_stmt 0 view .LVU139
 587 000c 024B     		ldr	r3, .L50+4
 588 000e 1C60     		str	r4, [r3]
  62:Core/Src/sd_card_spi.c **** 
 589              		.loc 1 62 1 view .LVU140
 590 0010 10BD     		pop	{r4, pc}
 591              	.LVL61:
 592              	.L51:
  62:Core/Src/sd_card_spi.c **** 
 593              		.loc 1 62 1 view .LVU141
 594 0012 00BF     		.align	2
 595              	.L50:
 596 0014 00000000 		.word	spiTimerTickStart
 597 0018 00000000 		.word	spiTimerTickDelay
 598              		.cfi_endproc
 599              	.LFE123:
 601              		.section	.text.SPI_Timer_Status,"ax",%progbits
 602              		.align	1
 603              		.global	SPI_Timer_Status
 604              		.syntax unified
 605              		.thumb
 606              		.thumb_func
 608              	SPI_Timer_Status:
 609              	.LFB124:
  64:Core/Src/sd_card_spi.c ****     return ((HAL_GetTick() - spiTimerTickStart) < spiTimerTickDelay);
 610              		.loc 1 64 28 is_stmt 1 view -0
 611              		.cfi_startproc
 612              		@ args = 0, pretend = 0, frame = 0
 613              		@ frame_needed = 0, uses_anonymous_args = 0
 614 0000 08B5     		push	{r3, lr}
 615              		.cfi_def_cfa_offset 8
 616              		.cfi_offset 3, -8
 617              		.cfi_offset 14, -4
  65:Core/Src/sd_card_spi.c **** }
 618              		.loc 1 65 5 view .LVU143
  65:Core/Src/sd_card_spi.c **** }
 619              		.loc 1 65 14 is_stmt 0 view .LVU144
 620 0002 FFF7FEFF 		bl	HAL_GetTick
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 17


 621              	.LVL62:
  65:Core/Src/sd_card_spi.c **** }
 622              		.loc 1 65 28 view .LVU145
 623 0006 054B     		ldr	r3, .L54
 624 0008 1B68     		ldr	r3, [r3]
 625 000a C01A     		subs	r0, r0, r3
  65:Core/Src/sd_card_spi.c **** }
 626              		.loc 1 65 49 view .LVU146
 627 000c 044B     		ldr	r3, .L54+4
 628 000e 1B68     		ldr	r3, [r3]
  66:Core/Src/sd_card_spi.c **** 
 629              		.loc 1 66 1 view .LVU147
 630 0010 9842     		cmp	r0, r3
 631 0012 2CBF     		ite	cs
 632 0014 0020     		movcs	r0, #0
 633 0016 0120     		movcc	r0, #1
 634 0018 08BD     		pop	{r3, pc}
 635              	.L55:
 636 001a 00BF     		.align	2
 637              	.L54:
 638 001c 00000000 		.word	spiTimerTickStart
 639 0020 00000000 		.word	spiTimerTickDelay
 640              		.cfi_endproc
 641              	.LFE124:
 643              		.section	.text.rcvr_datablock,"ax",%progbits
 644              		.align	1
 645              		.syntax unified
 646              		.thumb
 647              		.thumb_func
 649              	rcvr_datablock:
 650              	.LVL63:
 651              	.LFB131:
 153:Core/Src/sd_card_spi.c ****     BYTE token;
 652              		.loc 1 153 49 is_stmt 1 view -0
 653              		.cfi_startproc
 654              		@ args = 0, pretend = 0, frame = 0
 655              		@ frame_needed = 0, uses_anonymous_args = 0
 153:Core/Src/sd_card_spi.c ****     BYTE token;
 656              		.loc 1 153 49 is_stmt 0 view .LVU149
 657 0000 70B5     		push	{r4, r5, r6, lr}
 658              		.cfi_def_cfa_offset 16
 659              		.cfi_offset 4, -16
 660              		.cfi_offset 5, -12
 661              		.cfi_offset 6, -8
 662              		.cfi_offset 14, -4
 663 0002 0546     		mov	r5, r0
 664 0004 0E46     		mov	r6, r1
 154:Core/Src/sd_card_spi.c **** 
 665              		.loc 1 154 5 is_stmt 1 view .LVU150
 156:Core/Src/sd_card_spi.c **** 	do {							/* Wait for DataStart token in timeout of 200ms */
 666              		.loc 1 156 2 view .LVU151
 667 0006 C820     		movs	r0, #200
 668              	.LVL64:
 156:Core/Src/sd_card_spi.c **** 	do {							/* Wait for DataStart token in timeout of 200ms */
 669              		.loc 1 156 2 is_stmt 0 view .LVU152
 670 0008 FFF7FEFF 		bl	SPI_Timer_On
 671              	.LVL65:
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 18


 672              	.L58:
 157:Core/Src/sd_card_spi.c **** 		token = xchg_spi(0xFF);
 673              		.loc 1 157 2 is_stmt 1 discriminator 2 view .LVU153
 158:Core/Src/sd_card_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 674              		.loc 1 158 3 discriminator 2 view .LVU154
 158:Core/Src/sd_card_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 675              		.loc 1 158 11 is_stmt 0 discriminator 2 view .LVU155
 676 000c FF20     		movs	r0, #255
 677 000e FFF7FEFF 		bl	xchg_spi
 678              	.LVL66:
 679 0012 0446     		mov	r4, r0
 680              	.LVL67:
 160:Core/Src/sd_card_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 681              		.loc 1 160 27 is_stmt 1 discriminator 2 view .LVU156
 682 0014 FF28     		cmp	r0, #255
 683 0016 03D1     		bne	.L57
 160:Core/Src/sd_card_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 684              		.loc 1 160 30 is_stmt 0 discriminator 1 view .LVU157
 685 0018 FFF7FEFF 		bl	SPI_Timer_Status
 686              	.LVL68:
 160:Core/Src/sd_card_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 687              		.loc 1 160 27 discriminator 1 view .LVU158
 688 001c 0028     		cmp	r0, #0
 689 001e F5D1     		bne	.L58
 690              	.L57:
 161:Core/Src/sd_card_spi.c **** 
 691              		.loc 1 161 2 is_stmt 1 view .LVU159
 161:Core/Src/sd_card_spi.c **** 
 692              		.loc 1 161 4 is_stmt 0 view .LVU160
 693 0020 FE2C     		cmp	r4, #254
 694 0022 01D0     		beq	.L62
 161:Core/Src/sd_card_spi.c **** 
 695              		.loc 1 161 27 view .LVU161
 696 0024 0020     		movs	r0, #0
 697              	.L56:
 167:Core/Src/sd_card_spi.c **** 
 698              		.loc 1 167 1 view .LVU162
 699 0026 70BD     		pop	{r4, r5, r6, pc}
 700              	.LVL69:
 701              	.L62:
 163:Core/Src/sd_card_spi.c **** 	xchg_spi(0xFF); xchg_spi(0xFF);			/* Discard CRC */
 702              		.loc 1 163 2 is_stmt 1 view .LVU163
 703 0028 3146     		mov	r1, r6
 704 002a 2846     		mov	r0, r5
 705 002c FFF7FEFF 		bl	rcvr_spi_multi
 706              	.LVL70:
 164:Core/Src/sd_card_spi.c **** 
 707              		.loc 1 164 2 view .LVU164
 708 0030 FF20     		movs	r0, #255
 709 0032 FFF7FEFF 		bl	xchg_spi
 710              	.LVL71:
 164:Core/Src/sd_card_spi.c **** 
 711              		.loc 1 164 18 view .LVU165
 712 0036 FF20     		movs	r0, #255
 713 0038 FFF7FEFF 		bl	xchg_spi
 714              	.LVL72:
 166:Core/Src/sd_card_spi.c **** }
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 19


 715              		.loc 1 166 2 view .LVU166
 166:Core/Src/sd_card_spi.c **** }
 716              		.loc 1 166 9 is_stmt 0 view .LVU167
 717 003c 0120     		movs	r0, #1
 718 003e F2E7     		b	.L56
 719              		.cfi_endproc
 720              	.LFE131:
 722              		.section	.text.USER_SPI_initialize,"ax",%progbits
 723              		.align	1
 724              		.global	USER_SPI_initialize
 725              		.syntax unified
 726              		.thumb
 727              		.thumb_func
 729              	USER_SPI_initialize:
 730              	.LVL73:
 731              	.LFB134:
 232:Core/Src/sd_card_spi.c **** 
 233:Core/Src/sd_card_spi.c **** /*--------------------------------------------------------------------------
 234:Core/Src/sd_card_spi.c **** 
 235:Core/Src/sd_card_spi.c ****    Public FatFs Functions (wrapped in user_diskio.c)
 236:Core/Src/sd_card_spi.c **** 
 237:Core/Src/sd_card_spi.c **** ---------------------------------------------------------------------------*/
 238:Core/Src/sd_card_spi.c **** 
 239:Core/Src/sd_card_spi.c **** //The following functions are defined as inline because they aren't the functions that
 240:Core/Src/sd_card_spi.c **** //are passed to FatFs - they are wrapped by autogenerated (non-inline) cubemx template
 241:Core/Src/sd_card_spi.c **** //code.
 242:Core/Src/sd_card_spi.c **** //If you do not wish to use cubemx, remove the "inline" from these functions here
 243:Core/Src/sd_card_spi.c **** //and in the associated .h
 244:Core/Src/sd_card_spi.c **** 
 245:Core/Src/sd_card_spi.c **** 
 246:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 247:Core/Src/sd_card_spi.c **** /* Initialize disk drive                                                 */
 248:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 249:Core/Src/sd_card_spi.c **** 
 250:Core/Src/sd_card_spi.c **** inline DSTATUS USER_SPI_initialize (
 251:Core/Src/sd_card_spi.c **** 	BYTE drv		/* Physical drive number (0) */
 252:Core/Src/sd_card_spi.c **** )
 253:Core/Src/sd_card_spi.c **** {
 732              		.loc 1 253 1 is_stmt 1 view -0
 733              		.cfi_startproc
 734              		@ args = 0, pretend = 0, frame = 8
 735              		@ frame_needed = 0, uses_anonymous_args = 0
 254:Core/Src/sd_card_spi.c **** 	BYTE n, cmd, ty, ocr[4];
 736              		.loc 1 254 2 view .LVU169
 255:Core/Src/sd_card_spi.c **** 
 256:Core/Src/sd_card_spi.c **** 	if (drv != 0) return STA_NOINIT;		/* Supports only drive 0 */
 737              		.loc 1 256 2 view .LVU170
 738              		.loc 1 256 5 is_stmt 0 view .LVU171
 739 0000 0028     		cmp	r0, #0
 740 0002 40F0AD80 		bne	.L81
 257:Core/Src/sd_card_spi.c **** 	//assume SPI already init init_spi();	/* Initialize SPI */
 258:Core/Src/sd_card_spi.c **** 
 259:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NODISK) return Stat;	/* Is card existing in the soket? */
 741              		.loc 1 259 2 is_stmt 1 view .LVU172
 742              		.loc 1 259 11 is_stmt 0 view .LVU173
 743 0006 574B     		ldr	r3, .L97
 744 0008 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 20


 745              		.loc 1 259 5 view .LVU174
 746 000a 13F0020F 		tst	r3, #2
 747 000e 0BD1     		bne	.L91
 253:Core/Src/sd_card_spi.c **** 	BYTE n, cmd, ty, ocr[4];
 748              		.loc 1 253 1 view .LVU175
 749 0010 70B5     		push	{r4, r5, r6, lr}
 750              		.cfi_def_cfa_offset 16
 751              		.cfi_offset 4, -16
 752              		.cfi_offset 5, -12
 753              		.cfi_offset 6, -8
 754              		.cfi_offset 14, -4
 755 0012 82B0     		sub	sp, sp, #8
 756              		.cfi_def_cfa_offset 24
 260:Core/Src/sd_card_spi.c **** 
 261:Core/Src/sd_card_spi.c **** 	FCLK_SLOW();
 757              		.loc 1 261 2 is_stmt 1 view .LVU176
 758 0014 544B     		ldr	r3, .L97+4
 759 0016 1A68     		ldr	r2, [r3]
 760 0018 1368     		ldr	r3, [r2]
 761 001a 23F03803 		bic	r3, r3, #56
 762 001e 43F03003 		orr	r3, r3, #48
 763 0022 1360     		str	r3, [r2]
 764              		.loc 1 261 13 view .LVU177
 262:Core/Src/sd_card_spi.c **** 	for (n = 10; n; n--) xchg_spi(0xFF);	/* Send 80 dummy clocks */
 765              		.loc 1 262 2 view .LVU178
 766              	.LVL74:
 767              		.loc 1 262 9 is_stmt 0 view .LVU179
 768 0024 0A24     		movs	r4, #10
 769              		.loc 1 262 2 view .LVU180
 770 0026 08E0     		b	.L66
 771              	.LVL75:
 772              	.L91:
 773              		.cfi_def_cfa_offset 0
 774              		.cfi_restore 4
 775              		.cfi_restore 5
 776              		.cfi_restore 6
 777              		.cfi_restore 14
 259:Core/Src/sd_card_spi.c **** 
 778              		.loc 1 259 25 is_stmt 1 discriminator 1 view .LVU181
 259:Core/Src/sd_card_spi.c **** 
 779              		.loc 1 259 32 is_stmt 0 discriminator 1 view .LVU182
 780 0028 4E4B     		ldr	r3, .L97
 781 002a 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 782              	.LVL76:
 259:Core/Src/sd_card_spi.c **** 
 783              		.loc 1 259 32 discriminator 1 view .LVU183
 784 002c C0B2     		uxtb	r0, r0
 785 002e 7047     		bx	lr
 786              	.LVL77:
 787              	.L67:
 788              		.cfi_def_cfa_offset 24
 789              		.cfi_offset 4, -16
 790              		.cfi_offset 5, -12
 791              		.cfi_offset 6, -8
 792              		.cfi_offset 14, -4
 793              		.loc 1 262 23 is_stmt 1 discriminator 3 view .LVU184
 794 0030 FF20     		movs	r0, #255
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 21


 795 0032 FFF7FEFF 		bl	xchg_spi
 796              	.LVL78:
 797              		.loc 1 262 19 discriminator 3 view .LVU185
 798 0036 013C     		subs	r4, r4, #1
 799              	.LVL79:
 800              		.loc 1 262 19 is_stmt 0 discriminator 3 view .LVU186
 801 0038 E4B2     		uxtb	r4, r4
 802              	.LVL80:
 803              	.L66:
 804              		.loc 1 262 15 is_stmt 1 discriminator 1 view .LVU187
 805 003a 002C     		cmp	r4, #0
 806 003c F8D1     		bne	.L67
 263:Core/Src/sd_card_spi.c **** 
 264:Core/Src/sd_card_spi.c **** 	ty = 0;
 807              		.loc 1 264 2 view .LVU188
 808              	.LVL81:
 265:Core/Src/sd_card_spi.c **** 	if (send_cmd(CMD0, 0) == 1) {			/* Put the card SPI/Idle state */
 809              		.loc 1 265 2 view .LVU189
 810              		.loc 1 265 6 is_stmt 0 view .LVU190
 811 003e 0021     		movs	r1, #0
 812 0040 0846     		mov	r0, r1
 813 0042 FFF7FEFF 		bl	send_cmd
 814              	.LVL82:
 815 0046 0546     		mov	r5, r0
 816              		.loc 1 265 5 view .LVU191
 817 0048 0128     		cmp	r0, #1
 818 004a 17D0     		beq	.L92
 819              	.LVL83:
 820              	.L68:
 266:Core/Src/sd_card_spi.c **** 		SPI_Timer_On(1000);					/* Initialization timeout = 1 sec */
 267:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD8, 0x1AA) == 1) {	/* SDv2? */
 268:Core/Src/sd_card_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 269:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 270:Core/Src/sd_card_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 271:Core/Src/sd_card_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 272:Core/Src/sd_card_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 273:Core/Src/sd_card_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 274:Core/Src/sd_card_spi.c **** 				}
 275:Core/Src/sd_card_spi.c **** 			}
 276:Core/Src/sd_card_spi.c **** 		} else {	/* Not SDv2 card */
 277:Core/Src/sd_card_spi.c **** 			if (send_cmd(ACMD41, 0) <= 1) 	{	/* SDv1 or MMC? */
 278:Core/Src/sd_card_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 279:Core/Src/sd_card_spi.c **** 			} else {
 280:Core/Src/sd_card_spi.c **** 				ty = CT_MMC; cmd = CMD1;	/* MMCv3 (CMD1(0)) */
 281:Core/Src/sd_card_spi.c **** 			}
 282:Core/Src/sd_card_spi.c **** 			while (SPI_Timer_Status() && send_cmd(cmd, 0)) ;		/* Wait for end of initialization */
 283:Core/Src/sd_card_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 284:Core/Src/sd_card_spi.c **** 				ty = 0;
 285:Core/Src/sd_card_spi.c **** 		}
 286:Core/Src/sd_card_spi.c **** 	}
 287:Core/Src/sd_card_spi.c **** 	CardType = ty;	/* Card type */
 821              		.loc 1 287 2 is_stmt 1 view .LVU192
 822              		.loc 1 287 11 is_stmt 0 view .LVU193
 823 004c 474B     		ldr	r3, .L97+8
 824 004e 1C70     		strb	r4, [r3]
 288:Core/Src/sd_card_spi.c **** 	despiselect();
 825              		.loc 1 288 2 is_stmt 1 view .LVU194
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 22


 826 0050 FFF7FEFF 		bl	despiselect
 827              	.LVL84:
 289:Core/Src/sd_card_spi.c **** 
 290:Core/Src/sd_card_spi.c **** 	if (ty) {			/* OK */
 828              		.loc 1 290 2 view .LVU195
 829              		.loc 1 290 5 is_stmt 0 view .LVU196
 830 0054 002C     		cmp	r4, #0
 831 0056 7FD0     		beq	.L79
 291:Core/Src/sd_card_spi.c **** 		FCLK_FAST();			/* Set fast clock */
 832              		.loc 1 291 3 is_stmt 1 view .LVU197
 833 0058 434B     		ldr	r3, .L97+4
 834 005a 1A68     		ldr	r2, [r3]
 835 005c 1368     		ldr	r3, [r2]
 836 005e 23F03803 		bic	r3, r3, #56
 837 0062 43F01003 		orr	r3, r3, #16
 838 0066 1360     		str	r3, [r2]
 839              		.loc 1 291 14 view .LVU198
 292:Core/Src/sd_card_spi.c **** 		Stat &= ~STA_NOINIT;	/* Clear STA_NOINIT flag */
 840              		.loc 1 292 3 view .LVU199
 841              		.loc 1 292 8 is_stmt 0 view .LVU200
 842 0068 3E4A     		ldr	r2, .L97
 843 006a 1378     		ldrb	r3, [r2]	@ zero_extendqisi2
 844 006c 03F0FE03 		and	r3, r3, #254
 845 0070 1370     		strb	r3, [r2]
 846              	.L80:
 293:Core/Src/sd_card_spi.c **** 	} else {			/* Failed */
 294:Core/Src/sd_card_spi.c **** 		Stat = STA_NOINIT;
 295:Core/Src/sd_card_spi.c **** 	}
 296:Core/Src/sd_card_spi.c **** 
 297:Core/Src/sd_card_spi.c **** 	return Stat;
 847              		.loc 1 297 2 is_stmt 1 view .LVU201
 848              		.loc 1 297 9 is_stmt 0 view .LVU202
 849 0072 3C4B     		ldr	r3, .L97
 850 0074 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 851 0076 C0B2     		uxtb	r0, r0
 298:Core/Src/sd_card_spi.c **** }
 852              		.loc 1 298 1 view .LVU203
 853 0078 02B0     		add	sp, sp, #8
 854              		.cfi_remember_state
 855              		.cfi_def_cfa_offset 16
 856              		@ sp needed
 857 007a 70BD     		pop	{r4, r5, r6, pc}
 858              	.LVL85:
 859              	.L92:
 860              		.cfi_restore_state
 266:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD8, 0x1AA) == 1) {	/* SDv2? */
 861              		.loc 1 266 3 is_stmt 1 view .LVU204
 862 007c 4FF47A70 		mov	r0, #1000
 863 0080 FFF7FEFF 		bl	SPI_Timer_On
 864              	.LVL86:
 267:Core/Src/sd_card_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 865              		.loc 1 267 3 view .LVU205
 267:Core/Src/sd_card_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 866              		.loc 1 267 7 is_stmt 0 view .LVU206
 867 0084 4FF4D571 		mov	r1, #426
 868 0088 0820     		movs	r0, #8
 869 008a FFF7FEFF 		bl	send_cmd
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 23


 870              	.LVL87:
 267:Core/Src/sd_card_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 871              		.loc 1 267 6 view .LVU207
 872 008e 0128     		cmp	r0, #1
 873 0090 3ED1     		bne	.L93
 268:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 874              		.loc 1 268 11 view .LVU208
 875 0092 2546     		mov	r5, r4
 876 0094 09E0     		b	.L69
 877              	.LVL88:
 878              	.L71:
 268:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 879              		.loc 1 268 28 is_stmt 1 discriminator 3 view .LVU209
 268:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 880              		.loc 1 268 37 is_stmt 0 discriminator 3 view .LVU210
 881 0096 FF20     		movs	r0, #255
 882 0098 FFF7FEFF 		bl	xchg_spi
 883              	.LVL89:
 268:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 884              		.loc 1 268 35 discriminator 3 view .LVU211
 885 009c 05F10803 		add	r3, r5, #8
 886 00a0 6B44     		add	r3, sp, r3
 887 00a2 03F8040C 		strb	r0, [r3, #-4]
 268:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 888              		.loc 1 268 24 is_stmt 1 discriminator 3 view .LVU212
 889 00a6 0135     		adds	r5, r5, #1
 890              	.LVL90:
 268:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 891              		.loc 1 268 24 is_stmt 0 discriminator 3 view .LVU213
 892 00a8 EDB2     		uxtb	r5, r5
 893              	.LVL91:
 894              	.L69:
 268:Core/Src/sd_card_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 895              		.loc 1 268 18 is_stmt 1 discriminator 1 view .LVU214
 896 00aa 032D     		cmp	r5, #3
 897 00ac F3D9     		bls	.L71
 269:Core/Src/sd_card_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 898              		.loc 1 269 4 view .LVU215
 269:Core/Src/sd_card_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 899              		.loc 1 269 11 is_stmt 0 view .LVU216
 900 00ae 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 269:Core/Src/sd_card_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 901              		.loc 1 269 7 view .LVU217
 902 00b2 012B     		cmp	r3, #1
 903 00b4 CAD1     		bne	.L68
 269:Core/Src/sd_card_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 904              		.loc 1 269 29 discriminator 1 view .LVU218
 905 00b6 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 269:Core/Src/sd_card_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 906              		.loc 1 269 23 discriminator 1 view .LVU219
 907 00ba AA2B     		cmp	r3, #170
 908 00bc C6D1     		bne	.L68
 909              	.L73:
 270:Core/Src/sd_card_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 910              		.loc 1 270 31 is_stmt 1 discriminator 2 view .LVU220
 270:Core/Src/sd_card_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 911              		.loc 1 270 12 is_stmt 0 discriminator 2 view .LVU221
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 24


 912 00be FFF7FEFF 		bl	SPI_Timer_Status
 913              	.LVL92:
 270:Core/Src/sd_card_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 914              		.loc 1 270 31 discriminator 2 view .LVU222
 915 00c2 30B1     		cbz	r0, .L72
 270:Core/Src/sd_card_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 916              		.loc 1 270 34 discriminator 1 view .LVU223
 917 00c4 4FF08041 		mov	r1, #1073741824
 918 00c8 A920     		movs	r0, #169
 919 00ca FFF7FEFF 		bl	send_cmd
 920              	.LVL93:
 270:Core/Src/sd_card_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 921              		.loc 1 270 31 discriminator 1 view .LVU224
 922 00ce 0028     		cmp	r0, #0
 923 00d0 F5D1     		bne	.L73
 924              	.L72:
 271:Core/Src/sd_card_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 925              		.loc 1 271 5 is_stmt 1 view .LVU225
 271:Core/Src/sd_card_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 926              		.loc 1 271 9 is_stmt 0 view .LVU226
 927 00d2 FFF7FEFF 		bl	SPI_Timer_Status
 928              	.LVL94:
 271:Core/Src/sd_card_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 929              		.loc 1 271 8 view .LVU227
 930 00d6 08B9     		cbnz	r0, .L94
 264:Core/Src/sd_card_spi.c **** 	if (send_cmd(CMD0, 0) == 1) {			/* Put the card SPI/Idle state */
 931              		.loc 1 264 5 view .LVU228
 932 00d8 0446     		mov	r4, r0
 933 00da B7E7     		b	.L68
 934              	.L94:
 271:Core/Src/sd_card_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 935              		.loc 1 271 31 discriminator 1 view .LVU229
 936 00dc 0021     		movs	r1, #0
 937 00de 3A20     		movs	r0, #58
 938 00e0 FFF7FEFF 		bl	send_cmd
 939              	.LVL95:
 271:Core/Src/sd_card_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 940              		.loc 1 271 28 discriminator 1 view .LVU230
 941 00e4 0546     		mov	r5, r0
 942              	.LVL96:
 271:Core/Src/sd_card_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 943              		.loc 1 271 28 discriminator 1 view .LVU231
 944 00e6 50B1     		cbz	r0, .L74
 945 00e8 B0E7     		b	.L68
 946              	.LVL97:
 947              	.L75:
 272:Core/Src/sd_card_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 948              		.loc 1 272 30 is_stmt 1 discriminator 3 view .LVU232
 272:Core/Src/sd_card_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 949              		.loc 1 272 39 is_stmt 0 discriminator 3 view .LVU233
 950 00ea FF20     		movs	r0, #255
 951 00ec FFF7FEFF 		bl	xchg_spi
 952              	.LVL98:
 272:Core/Src/sd_card_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 953              		.loc 1 272 37 discriminator 3 view .LVU234
 954 00f0 05F10803 		add	r3, r5, #8
 955 00f4 6B44     		add	r3, sp, r3
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 25


 956 00f6 03F8040C 		strb	r0, [r3, #-4]
 272:Core/Src/sd_card_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 957              		.loc 1 272 26 is_stmt 1 discriminator 3 view .LVU235
 958 00fa 0135     		adds	r5, r5, #1
 959              	.LVL99:
 272:Core/Src/sd_card_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 960              		.loc 1 272 26 is_stmt 0 discriminator 3 view .LVU236
 961 00fc EDB2     		uxtb	r5, r5
 962              	.LVL100:
 963              	.L74:
 272:Core/Src/sd_card_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 964              		.loc 1 272 20 is_stmt 1 discriminator 1 view .LVU237
 965 00fe 032D     		cmp	r5, #3
 966 0100 F3D9     		bls	.L75
 273:Core/Src/sd_card_spi.c **** 				}
 967              		.loc 1 273 6 view .LVU238
 273:Core/Src/sd_card_spi.c **** 				}
 968              		.loc 1 273 15 is_stmt 0 view .LVU239
 969 0102 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 273:Core/Src/sd_card_spi.c **** 				}
 970              		.loc 1 273 9 view .LVU240
 971 0106 13F0400F 		tst	r3, #64
 972 010a 23D0     		beq	.L84
 973 010c 0C24     		movs	r4, #12
 974 010e 9DE7     		b	.L68
 975              	.LVL101:
 976              	.L93:
 277:Core/Src/sd_card_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 977              		.loc 1 277 4 is_stmt 1 view .LVU241
 277:Core/Src/sd_card_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 978              		.loc 1 277 8 is_stmt 0 view .LVU242
 979 0110 0021     		movs	r1, #0
 980 0112 A920     		movs	r0, #169
 981 0114 FFF7FEFF 		bl	send_cmd
 982              	.LVL102:
 277:Core/Src/sd_card_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 983              		.loc 1 277 7 view .LVU243
 984 0118 0128     		cmp	r0, #1
 985 011a 0ED9     		bls	.L95
 280:Core/Src/sd_card_spi.c **** 			}
 986              		.loc 1 280 8 view .LVU244
 987 011c 2E46     		mov	r6, r5
 988              	.LVL103:
 989              	.L78:
 282:Core/Src/sd_card_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 990              		.loc 1 282 30 is_stmt 1 discriminator 2 view .LVU245
 282:Core/Src/sd_card_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 991              		.loc 1 282 11 is_stmt 0 discriminator 2 view .LVU246
 992 011e FFF7FEFF 		bl	SPI_Timer_Status
 993              	.LVL104:
 282:Core/Src/sd_card_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 994              		.loc 1 282 30 discriminator 2 view .LVU247
 995 0122 28B1     		cbz	r0, .L77
 282:Core/Src/sd_card_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 996              		.loc 1 282 33 discriminator 1 view .LVU248
 997 0124 0021     		movs	r1, #0
 998 0126 2846     		mov	r0, r5
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 26


 999 0128 FFF7FEFF 		bl	send_cmd
 1000              	.LVL105:
 282:Core/Src/sd_card_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 1001              		.loc 1 282 30 discriminator 1 view .LVU249
 1002 012c 0028     		cmp	r0, #0
 1003 012e F6D1     		bne	.L78
 1004              	.L77:
 283:Core/Src/sd_card_spi.c **** 				ty = 0;
 1005              		.loc 1 283 4 is_stmt 1 view .LVU250
 283:Core/Src/sd_card_spi.c **** 				ty = 0;
 1006              		.loc 1 283 9 is_stmt 0 view .LVU251
 1007 0130 FFF7FEFF 		bl	SPI_Timer_Status
 1008              	.LVL106:
 283:Core/Src/sd_card_spi.c **** 				ty = 0;
 1009              		.loc 1 283 7 view .LVU252
 1010 0134 20B9     		cbnz	r0, .L96
 284:Core/Src/sd_card_spi.c **** 		}
 1011              		.loc 1 284 8 view .LVU253
 1012 0136 0446     		mov	r4, r0
 1013              	.LVL107:
 284:Core/Src/sd_card_spi.c **** 		}
 1014              		.loc 1 284 8 view .LVU254
 1015 0138 88E7     		b	.L68
 1016              	.LVL108:
 1017              	.L95:
 278:Core/Src/sd_card_spi.c **** 			} else {
 1018              		.loc 1 278 8 view .LVU255
 1019 013a 0226     		movs	r6, #2
 278:Core/Src/sd_card_spi.c **** 			} else {
 1020              		.loc 1 278 22 view .LVU256
 1021 013c A925     		movs	r5, #169
 1022 013e EEE7     		b	.L78
 1023              	.LVL109:
 1024              	.L96:
 283:Core/Src/sd_card_spi.c **** 				ty = 0;
 1025              		.loc 1 283 31 discriminator 1 view .LVU257
 1026 0140 4FF40071 		mov	r1, #512
 1027 0144 1020     		movs	r0, #16
 1028 0146 FFF7FEFF 		bl	send_cmd
 1029              	.LVL110:
 283:Core/Src/sd_card_spi.c **** 				ty = 0;
 1030              		.loc 1 283 28 discriminator 1 view .LVU258
 1031 014a 0028     		cmp	r0, #0
 1032 014c 7FF47EAF 		bne	.L68
 283:Core/Src/sd_card_spi.c **** 				ty = 0;
 1033              		.loc 1 283 28 view .LVU259
 1034 0150 3446     		mov	r4, r6
 1035              	.LVL111:
 283:Core/Src/sd_card_spi.c **** 				ty = 0;
 1036              		.loc 1 283 28 view .LVU260
 1037 0152 7BE7     		b	.L68
 1038              	.LVL112:
 1039              	.L84:
 273:Core/Src/sd_card_spi.c **** 				}
 1040              		.loc 1 273 9 view .LVU261
 1041 0154 0424     		movs	r4, #4
 1042 0156 79E7     		b	.L68
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 27


 1043              	.LVL113:
 1044              	.L79:
 294:Core/Src/sd_card_spi.c **** 	}
 1045              		.loc 1 294 3 is_stmt 1 view .LVU262
 294:Core/Src/sd_card_spi.c **** 	}
 1046              		.loc 1 294 8 is_stmt 0 view .LVU263
 1047 0158 024B     		ldr	r3, .L97
 1048 015a 0122     		movs	r2, #1
 1049 015c 1A70     		strb	r2, [r3]
 1050 015e 88E7     		b	.L80
 1051              	.LVL114:
 1052              	.L81:
 1053              		.cfi_def_cfa_offset 0
 1054              		.cfi_restore 4
 1055              		.cfi_restore 5
 1056              		.cfi_restore 6
 1057              		.cfi_restore 14
 256:Core/Src/sd_card_spi.c **** 	//assume SPI already init init_spi();	/* Initialize SPI */
 1058              		.loc 1 256 23 view .LVU264
 1059 0160 0120     		movs	r0, #1
 1060              	.LVL115:
 1061              		.loc 1 298 1 view .LVU265
 1062 0162 7047     		bx	lr
 1063              	.L98:
 1064              		.align	2
 1065              	.L97:
 1066 0164 00000000 		.word	Stat
 1067 0168 00000000 		.word	hspi1
 1068 016c 00000000 		.word	CardType
 1069              		.cfi_endproc
 1070              	.LFE134:
 1072              		.section	.text.USER_SPI_status,"ax",%progbits
 1073              		.align	1
 1074              		.global	USER_SPI_status
 1075              		.syntax unified
 1076              		.thumb
 1077              		.thumb_func
 1079              	USER_SPI_status:
 1080              	.LVL116:
 1081              	.LFB135:
 299:Core/Src/sd_card_spi.c **** 
 300:Core/Src/sd_card_spi.c **** 
 301:Core/Src/sd_card_spi.c **** 
 302:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 303:Core/Src/sd_card_spi.c **** /* Get disk status                                                       */
 304:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 305:Core/Src/sd_card_spi.c **** 
 306:Core/Src/sd_card_spi.c **** inline DSTATUS USER_SPI_status (
 307:Core/Src/sd_card_spi.c **** 	BYTE drv		/* Physical drive number (0) */
 308:Core/Src/sd_card_spi.c **** )
 309:Core/Src/sd_card_spi.c **** {
 1082              		.loc 1 309 1 is_stmt 1 view -0
 1083              		.cfi_startproc
 1084              		@ args = 0, pretend = 0, frame = 0
 1085              		@ frame_needed = 0, uses_anonymous_args = 0
 1086              		@ link register save eliminated.
 310:Core/Src/sd_card_spi.c **** 	if (drv) return STA_NOINIT;		/* Supports only drive 0 */
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 28


 1087              		.loc 1 310 2 view .LVU267
 1088              		.loc 1 310 5 is_stmt 0 view .LVU268
 1089 0000 18B9     		cbnz	r0, .L101
 311:Core/Src/sd_card_spi.c **** 
 312:Core/Src/sd_card_spi.c **** 	return Stat;	/* Return disk status */
 1090              		.loc 1 312 2 is_stmt 1 view .LVU269
 1091              		.loc 1 312 9 is_stmt 0 view .LVU270
 1092 0002 034B     		ldr	r3, .L102
 1093 0004 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 1094              	.LVL117:
 1095              		.loc 1 312 9 view .LVU271
 1096 0006 C0B2     		uxtb	r0, r0
 1097 0008 7047     		bx	lr
 1098              	.LVL118:
 1099              	.L101:
 310:Core/Src/sd_card_spi.c **** 	if (drv) return STA_NOINIT;		/* Supports only drive 0 */
 1100              		.loc 1 310 18 view .LVU272
 1101 000a 0120     		movs	r0, #1
 1102              	.LVL119:
 313:Core/Src/sd_card_spi.c **** }
 1103              		.loc 1 313 1 view .LVU273
 1104 000c 7047     		bx	lr
 1105              	.L103:
 1106 000e 00BF     		.align	2
 1107              	.L102:
 1108 0010 00000000 		.word	Stat
 1109              		.cfi_endproc
 1110              	.LFE135:
 1112              		.section	.text.USER_SPI_read,"ax",%progbits
 1113              		.align	1
 1114              		.global	USER_SPI_read
 1115              		.syntax unified
 1116              		.thumb
 1117              		.thumb_func
 1119              	USER_SPI_read:
 1120              	.LVL120:
 1121              	.LFB136:
 314:Core/Src/sd_card_spi.c **** 
 315:Core/Src/sd_card_spi.c **** 
 316:Core/Src/sd_card_spi.c **** 
 317:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 318:Core/Src/sd_card_spi.c **** /* Read sector(s)                                                        */
 319:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 320:Core/Src/sd_card_spi.c **** 
 321:Core/Src/sd_card_spi.c **** inline DRESULT USER_SPI_read (
 322:Core/Src/sd_card_spi.c **** 	BYTE drv,		/* Physical drive number (0) */
 323:Core/Src/sd_card_spi.c **** 	BYTE *buff,		/* Pointer to the data buffer to store read data */
 324:Core/Src/sd_card_spi.c **** 	DWORD sector,	/* Start sector number (LBA) */
 325:Core/Src/sd_card_spi.c **** 	UINT count		/* Number of sectors to read (1..128) */
 326:Core/Src/sd_card_spi.c **** )
 327:Core/Src/sd_card_spi.c **** {
 1122              		.loc 1 327 1 is_stmt 1 view -0
 1123              		.cfi_startproc
 1124              		@ args = 0, pretend = 0, frame = 0
 1125              		@ frame_needed = 0, uses_anonymous_args = 0
 328:Core/Src/sd_card_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1126              		.loc 1 328 2 view .LVU275
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 29


 1127              		.loc 1 328 5 is_stmt 0 view .LVU276
 1128 0000 0028     		cmp	r0, #0
 1129 0002 39D1     		bne	.L111
 327:Core/Src/sd_card_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1130              		.loc 1 327 1 discriminator 2 view .LVU277
 1131 0004 38B5     		push	{r3, r4, r5, lr}
 1132              		.cfi_def_cfa_offset 16
 1133              		.cfi_offset 3, -16
 1134              		.cfi_offset 4, -12
 1135              		.cfi_offset 5, -8
 1136              		.cfi_offset 14, -4
 1137 0006 0D46     		mov	r5, r1
 1138 0008 1C46     		mov	r4, r3
 1139              		.loc 1 328 10 discriminator 2 view .LVU278
 1140 000a 002B     		cmp	r3, #0
 1141 000c 36D0     		beq	.L112
 329:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1142              		.loc 1 329 2 is_stmt 1 view .LVU279
 1143              		.loc 1 329 11 is_stmt 0 view .LVU280
 1144 000e 1D4B     		ldr	r3, .L120
 1145              	.LVL121:
 1146              		.loc 1 329 11 view .LVU281
 1147 0010 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1148              		.loc 1 329 5 view .LVU282
 1149 0012 13F0010F 		tst	r3, #1
 1150 0016 33D1     		bne	.L113
 330:Core/Src/sd_card_spi.c **** 
 331:Core/Src/sd_card_spi.c **** 	if (!(CardType & CT_BLOCK)) sector *= 512;	/* LBA ot BA conversion (byte addressing cards) */
 1151              		.loc 1 331 2 is_stmt 1 view .LVU283
 1152              		.loc 1 331 17 is_stmt 0 view .LVU284
 1153 0018 1B4B     		ldr	r3, .L120+4
 1154 001a 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1155              		.loc 1 331 5 view .LVU285
 1156 001c 13F0080F 		tst	r3, #8
 1157 0020 00D1     		bne	.L106
 1158              		.loc 1 331 30 is_stmt 1 discriminator 1 view .LVU286
 1159              		.loc 1 331 37 is_stmt 0 discriminator 1 view .LVU287
 1160 0022 5202     		lsls	r2, r2, #9
 1161              	.LVL122:
 1162              	.L106:
 332:Core/Src/sd_card_spi.c **** 
 333:Core/Src/sd_card_spi.c **** 	if (count == 1) {	/* Single sector read */
 1163              		.loc 1 333 2 is_stmt 1 view .LVU288
 1164              		.loc 1 333 5 is_stmt 0 view .LVU289
 1165 0024 012C     		cmp	r4, #1
 1166 0026 18D0     		beq	.L119
 334:Core/Src/sd_card_spi.c **** 		if ((send_cmd(CMD17, sector) == 0)	/* READ_SINGLE_BLOCK */
 335:Core/Src/sd_card_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 336:Core/Src/sd_card_spi.c **** 			count = 0;
 337:Core/Src/sd_card_spi.c **** 		}
 338:Core/Src/sd_card_spi.c **** 	}
 339:Core/Src/sd_card_spi.c **** 	else {				/* Multiple sector read */
 340:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD18, sector) == 0) {	/* READ_MULTIPLE_BLOCK */
 1167              		.loc 1 340 3 is_stmt 1 view .LVU290
 1168              		.loc 1 340 7 is_stmt 0 view .LVU291
 1169 0028 1146     		mov	r1, r2
 1170              	.LVL123:
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 30


 1171              		.loc 1 340 7 view .LVU292
 1172 002a 1220     		movs	r0, #18
 1173              	.LVL124:
 1174              		.loc 1 340 7 view .LVU293
 1175 002c FFF7FEFF 		bl	send_cmd
 1176              	.LVL125:
 1177              		.loc 1 340 6 view .LVU294
 1178 0030 68B9     		cbnz	r0, .L108
 1179              	.L110:
 341:Core/Src/sd_card_spi.c **** 			do {
 1180              		.loc 1 341 4 is_stmt 1 view .LVU295
 342:Core/Src/sd_card_spi.c **** 				if (!rcvr_datablock(buff, 512)) break;
 1181              		.loc 1 342 5 view .LVU296
 1182              		.loc 1 342 10 is_stmt 0 view .LVU297
 1183 0032 4FF40071 		mov	r1, #512
 1184 0036 2846     		mov	r0, r5
 1185 0038 FFF7FEFF 		bl	rcvr_datablock
 1186              	.LVL126:
 1187              		.loc 1 342 8 view .LVU298
 1188 003c 18B1     		cbz	r0, .L109
 343:Core/Src/sd_card_spi.c **** 				buff += 512;
 1189              		.loc 1 343 5 is_stmt 1 view .LVU299
 1190              		.loc 1 343 10 is_stmt 0 view .LVU300
 1191 003e 05F50075 		add	r5, r5, #512
 1192              	.LVL127:
 344:Core/Src/sd_card_spi.c **** 			} while (--count);
 1193              		.loc 1 344 13 is_stmt 1 view .LVU301
 1194              		.loc 1 344 13 is_stmt 0 view .LVU302
 1195 0042 013C     		subs	r4, r4, #1
 1196              	.LVL128:
 1197              		.loc 1 344 13 view .LVU303
 1198 0044 F5D1     		bne	.L110
 1199              	.L109:
 345:Core/Src/sd_card_spi.c **** 			send_cmd(CMD12, 0);				/* STOP_TRANSMISSION */
 1200              		.loc 1 345 4 is_stmt 1 view .LVU304
 1201 0046 0021     		movs	r1, #0
 1202 0048 0C20     		movs	r0, #12
 1203 004a FFF7FEFF 		bl	send_cmd
 1204              	.LVL129:
 1205              	.L108:
 346:Core/Src/sd_card_spi.c **** 		}
 347:Core/Src/sd_card_spi.c **** 	}
 348:Core/Src/sd_card_spi.c **** 	despiselect();
 1206              		.loc 1 348 2 view .LVU305
 1207 004e FFF7FEFF 		bl	despiselect
 1208              	.LVL130:
 349:Core/Src/sd_card_spi.c **** 
 350:Core/Src/sd_card_spi.c **** 	return count ? RES_ERROR : RES_OK;	/* Return result */
 1209              		.loc 1 350 2 view .LVU306
 1210              		.loc 1 350 27 is_stmt 0 view .LVU307
 1211 0052 201E     		subs	r0, r4, #0
 1212 0054 18BF     		it	ne
 1213 0056 0120     		movne	r0, #1
 1214              	.LVL131:
 1215              	.L105:
 351:Core/Src/sd_card_spi.c **** }
 1216              		.loc 1 351 1 view .LVU308
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 31


 1217 0058 38BD     		pop	{r3, r4, r5, pc}
 1218              	.LVL132:
 1219              	.L119:
 334:Core/Src/sd_card_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1220              		.loc 1 334 3 is_stmt 1 view .LVU309
 334:Core/Src/sd_card_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1221              		.loc 1 334 8 is_stmt 0 view .LVU310
 1222 005a 1146     		mov	r1, r2
 1223              	.LVL133:
 334:Core/Src/sd_card_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1224              		.loc 1 334 8 view .LVU311
 1225 005c 1120     		movs	r0, #17
 1226              	.LVL134:
 334:Core/Src/sd_card_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1227              		.loc 1 334 8 view .LVU312
 1228 005e FFF7FEFF 		bl	send_cmd
 1229              	.LVL135:
 334:Core/Src/sd_card_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1230              		.loc 1 334 6 view .LVU313
 1231 0062 0028     		cmp	r0, #0
 1232 0064 F3D1     		bne	.L108
 335:Core/Src/sd_card_spi.c **** 			count = 0;
 1233              		.loc 1 335 7 view .LVU314
 1234 0066 4FF40071 		mov	r1, #512
 1235 006a 2846     		mov	r0, r5
 1236 006c FFF7FEFF 		bl	rcvr_datablock
 1237              	.LVL136:
 335:Core/Src/sd_card_spi.c **** 			count = 0;
 1238              		.loc 1 335 4 view .LVU315
 1239 0070 0028     		cmp	r0, #0
 1240 0072 ECD0     		beq	.L108
 336:Core/Src/sd_card_spi.c **** 		}
 1241              		.loc 1 336 10 view .LVU316
 1242 0074 0024     		movs	r4, #0
 1243              	.LVL137:
 336:Core/Src/sd_card_spi.c **** 		}
 1244              		.loc 1 336 10 view .LVU317
 1245 0076 EAE7     		b	.L108
 1246              	.LVL138:
 1247              	.L111:
 1248              		.cfi_def_cfa_offset 0
 1249              		.cfi_restore 3
 1250              		.cfi_restore 4
 1251              		.cfi_restore 5
 1252              		.cfi_restore 14
 328:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1253              		.loc 1 328 28 view .LVU318
 1254 0078 0420     		movs	r0, #4
 1255              	.LVL139:
 1256              		.loc 1 351 1 view .LVU319
 1257 007a 7047     		bx	lr
 1258              	.LVL140:
 1259              	.L112:
 1260              		.cfi_def_cfa_offset 16
 1261              		.cfi_offset 3, -16
 1262              		.cfi_offset 4, -12
 1263              		.cfi_offset 5, -8
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 32


 1264              		.cfi_offset 14, -4
 328:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1265              		.loc 1 328 28 view .LVU320
 1266 007c 0420     		movs	r0, #4
 1267              	.LVL141:
 328:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1268              		.loc 1 328 28 view .LVU321
 1269 007e EBE7     		b	.L105
 1270              	.LVL142:
 1271              	.L113:
 329:Core/Src/sd_card_spi.c **** 
 1272              		.loc 1 329 32 view .LVU322
 1273 0080 0320     		movs	r0, #3
 1274              	.LVL143:
 329:Core/Src/sd_card_spi.c **** 
 1275              		.loc 1 329 32 view .LVU323
 1276 0082 E9E7     		b	.L105
 1277              	.L121:
 1278              		.align	2
 1279              	.L120:
 1280 0084 00000000 		.word	Stat
 1281 0088 00000000 		.word	CardType
 1282              		.cfi_endproc
 1283              	.LFE136:
 1285              		.section	.text.USER_SPI_write,"ax",%progbits
 1286              		.align	1
 1287              		.global	USER_SPI_write
 1288              		.syntax unified
 1289              		.thumb
 1290              		.thumb_func
 1292              	USER_SPI_write:
 1293              	.LVL144:
 1294              	.LFB137:
 352:Core/Src/sd_card_spi.c **** 
 353:Core/Src/sd_card_spi.c **** 
 354:Core/Src/sd_card_spi.c **** 
 355:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 356:Core/Src/sd_card_spi.c **** /* Write sector(s)                                                       */
 357:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 358:Core/Src/sd_card_spi.c **** 
 359:Core/Src/sd_card_spi.c **** #if _USE_WRITE
 360:Core/Src/sd_card_spi.c **** inline DRESULT USER_SPI_write (
 361:Core/Src/sd_card_spi.c **** 	BYTE drv,			/* Physical drive number (0) */
 362:Core/Src/sd_card_spi.c **** 	const BYTE *buff,	/* Ponter to the data to write */
 363:Core/Src/sd_card_spi.c **** 	DWORD sector,		/* Start sector number (LBA) */
 364:Core/Src/sd_card_spi.c **** 	UINT count			/* Number of sectors to write (1..128) */
 365:Core/Src/sd_card_spi.c **** )
 366:Core/Src/sd_card_spi.c **** {
 1295              		.loc 1 366 1 is_stmt 1 view -0
 1296              		.cfi_startproc
 1297              		@ args = 0, pretend = 0, frame = 0
 1298              		@ frame_needed = 0, uses_anonymous_args = 0
 367:Core/Src/sd_card_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1299              		.loc 1 367 2 view .LVU325
 1300              		.loc 1 367 5 is_stmt 0 view .LVU326
 1301 0000 0028     		cmp	r0, #0
 1302 0002 48D1     		bne	.L130
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 33


 366:Core/Src/sd_card_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1303              		.loc 1 366 1 discriminator 2 view .LVU327
 1304 0004 70B5     		push	{r4, r5, r6, lr}
 1305              		.cfi_def_cfa_offset 16
 1306              		.cfi_offset 4, -16
 1307              		.cfi_offset 5, -12
 1308              		.cfi_offset 6, -8
 1309              		.cfi_offset 14, -4
 1310 0006 0D46     		mov	r5, r1
 1311 0008 1646     		mov	r6, r2
 1312 000a 1C46     		mov	r4, r3
 1313              		.loc 1 367 10 discriminator 2 view .LVU328
 1314 000c 002B     		cmp	r3, #0
 1315 000e 44D0     		beq	.L131
 368:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1316              		.loc 1 368 2 is_stmt 1 view .LVU329
 1317              		.loc 1 368 11 is_stmt 0 view .LVU330
 1318 0010 254B     		ldr	r3, .L142
 1319              	.LVL145:
 1320              		.loc 1 368 11 view .LVU331
 1321 0012 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1322              		.loc 1 368 5 view .LVU332
 1323 0014 13F0010F 		tst	r3, #1
 1324 0018 41D1     		bne	.L132
 369:Core/Src/sd_card_spi.c **** 	if (Stat & STA_PROTECT) return RES_WRPRT;	/* Check write protect */
 1325              		.loc 1 369 2 is_stmt 1 view .LVU333
 1326              		.loc 1 369 11 is_stmt 0 view .LVU334
 1327 001a 234B     		ldr	r3, .L142
 1328 001c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1329              		.loc 1 369 5 view .LVU335
 1330 001e 13F0040F 		tst	r3, #4
 1331 0022 3ED1     		bne	.L133
 370:Core/Src/sd_card_spi.c **** 
 371:Core/Src/sd_card_spi.c **** 	if (!(CardType & CT_BLOCK)) sector *= 512;	/* LBA ==> BA conversion (byte addressing cards) */
 1332              		.loc 1 371 2 is_stmt 1 view .LVU336
 1333              		.loc 1 371 17 is_stmt 0 view .LVU337
 1334 0024 214B     		ldr	r3, .L142+4
 1335 0026 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1336              		.loc 1 371 5 view .LVU338
 1337 0028 13F0080F 		tst	r3, #8
 1338 002c 00D1     		bne	.L124
 1339              		.loc 1 371 30 is_stmt 1 discriminator 1 view .LVU339
 1340              		.loc 1 371 37 is_stmt 0 discriminator 1 view .LVU340
 1341 002e 5602     		lsls	r6, r2, #9
 1342              	.LVL146:
 1343              	.L124:
 372:Core/Src/sd_card_spi.c **** 
 373:Core/Src/sd_card_spi.c **** 	if (count == 1) {	/* Single sector write */
 1344              		.loc 1 373 2 is_stmt 1 view .LVU341
 1345              		.loc 1 373 5 is_stmt 0 view .LVU342
 1346 0030 012C     		cmp	r4, #1
 1347 0032 1BD0     		beq	.L140
 374:Core/Src/sd_card_spi.c **** 		if ((send_cmd(CMD24, sector) == 0)	/* WRITE_BLOCK */
 375:Core/Src/sd_card_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 376:Core/Src/sd_card_spi.c **** 			count = 0;
 377:Core/Src/sd_card_spi.c **** 		}
 378:Core/Src/sd_card_spi.c **** 	}
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 34


 379:Core/Src/sd_card_spi.c **** 	else {				/* Multiple sector write */
 380:Core/Src/sd_card_spi.c **** 		if (CardType & CT_SDC) send_cmd(ACMD23, count);	/* Predefine number of sectors */
 1348              		.loc 1 380 3 is_stmt 1 view .LVU343
 1349              		.loc 1 380 6 is_stmt 0 view .LVU344
 1350 0034 13F0060F 		tst	r3, #6
 1351 0038 26D1     		bne	.L141
 1352              	.LVL147:
 1353              	.L127:
 381:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1354              		.loc 1 381 3 is_stmt 1 view .LVU345
 1355              		.loc 1 381 7 is_stmt 0 view .LVU346
 1356 003a 3146     		mov	r1, r6
 1357 003c 1920     		movs	r0, #25
 1358 003e FFF7FEFF 		bl	send_cmd
 1359              	.LVL148:
 1360              		.loc 1 381 6 view .LVU347
 1361 0042 68B9     		cbnz	r0, .L126
 1362              	.L129:
 382:Core/Src/sd_card_spi.c **** 			do {
 1363              		.loc 1 382 4 is_stmt 1 view .LVU348
 383:Core/Src/sd_card_spi.c **** 				if (!xmit_datablock(buff, 0xFC)) break;
 1364              		.loc 1 383 5 view .LVU349
 1365              		.loc 1 383 10 is_stmt 0 view .LVU350
 1366 0044 FC21     		movs	r1, #252
 1367 0046 2846     		mov	r0, r5
 1368 0048 FFF7FEFF 		bl	xmit_datablock
 1369              	.LVL149:
 1370              		.loc 1 383 8 view .LVU351
 1371 004c 18B1     		cbz	r0, .L128
 384:Core/Src/sd_card_spi.c **** 				buff += 512;
 1372              		.loc 1 384 5 is_stmt 1 view .LVU352
 1373              		.loc 1 384 10 is_stmt 0 view .LVU353
 1374 004e 05F50075 		add	r5, r5, #512
 1375              	.LVL150:
 385:Core/Src/sd_card_spi.c **** 			} while (--count);
 1376              		.loc 1 385 13 is_stmt 1 view .LVU354
 1377              		.loc 1 385 13 is_stmt 0 view .LVU355
 1378 0052 013C     		subs	r4, r4, #1
 1379              	.LVL151:
 1380              		.loc 1 385 13 view .LVU356
 1381 0054 F6D1     		bne	.L129
 1382              	.L128:
 386:Core/Src/sd_card_spi.c **** 			if (!xmit_datablock(0, 0xFD)) count = 1;	/* STOP_TRAN token */
 1383              		.loc 1 386 4 is_stmt 1 view .LVU357
 1384              		.loc 1 386 9 is_stmt 0 view .LVU358
 1385 0056 FD21     		movs	r1, #253
 1386 0058 0020     		movs	r0, #0
 1387 005a FFF7FEFF 		bl	xmit_datablock
 1388              	.LVL152:
 1389              		.loc 1 386 7 view .LVU359
 1390 005e C0B1     		cbz	r0, .L135
 1391              	.LVL153:
 1392              	.L126:
 387:Core/Src/sd_card_spi.c **** 		}
 388:Core/Src/sd_card_spi.c **** 	}
 389:Core/Src/sd_card_spi.c **** 	despiselect();
 1393              		.loc 1 389 2 is_stmt 1 view .LVU360
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 35


 1394 0060 FFF7FEFF 		bl	despiselect
 1395              	.LVL154:
 390:Core/Src/sd_card_spi.c **** 
 391:Core/Src/sd_card_spi.c **** 	return count ? RES_ERROR : RES_OK;	/* Return result */
 1396              		.loc 1 391 2 view .LVU361
 1397              		.loc 1 391 27 is_stmt 0 view .LVU362
 1398 0064 201E     		subs	r0, r4, #0
 1399 0066 18BF     		it	ne
 1400 0068 0120     		movne	r0, #1
 1401              	.L123:
 392:Core/Src/sd_card_spi.c **** }
 1402              		.loc 1 392 1 view .LVU363
 1403 006a 70BD     		pop	{r4, r5, r6, pc}
 1404              	.LVL155:
 1405              	.L140:
 374:Core/Src/sd_card_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1406              		.loc 1 374 3 is_stmt 1 view .LVU364
 374:Core/Src/sd_card_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1407              		.loc 1 374 8 is_stmt 0 view .LVU365
 1408 006c 3146     		mov	r1, r6
 1409              	.LVL156:
 374:Core/Src/sd_card_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1410              		.loc 1 374 8 view .LVU366
 1411 006e 1820     		movs	r0, #24
 1412              	.LVL157:
 374:Core/Src/sd_card_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1413              		.loc 1 374 8 view .LVU367
 1414 0070 FFF7FEFF 		bl	send_cmd
 1415              	.LVL158:
 374:Core/Src/sd_card_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1416              		.loc 1 374 6 view .LVU368
 1417 0074 0028     		cmp	r0, #0
 1418 0076 F3D1     		bne	.L126
 375:Core/Src/sd_card_spi.c **** 			count = 0;
 1419              		.loc 1 375 7 view .LVU369
 1420 0078 FE21     		movs	r1, #254
 1421 007a 2846     		mov	r0, r5
 1422 007c FFF7FEFF 		bl	xmit_datablock
 1423              	.LVL159:
 375:Core/Src/sd_card_spi.c **** 			count = 0;
 1424              		.loc 1 375 4 view .LVU370
 1425 0080 0028     		cmp	r0, #0
 1426 0082 EDD0     		beq	.L126
 376:Core/Src/sd_card_spi.c **** 		}
 1427              		.loc 1 376 10 view .LVU371
 1428 0084 0024     		movs	r4, #0
 1429              	.LVL160:
 376:Core/Src/sd_card_spi.c **** 		}
 1430              		.loc 1 376 10 view .LVU372
 1431 0086 EBE7     		b	.L126
 1432              	.LVL161:
 1433              	.L141:
 380:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1434              		.loc 1 380 26 is_stmt 1 discriminator 1 view .LVU373
 1435 0088 2146     		mov	r1, r4
 1436              	.LVL162:
 380:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 36


 1437              		.loc 1 380 26 is_stmt 0 discriminator 1 view .LVU374
 1438 008a 9720     		movs	r0, #151
 1439              	.LVL163:
 380:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1440              		.loc 1 380 26 discriminator 1 view .LVU375
 1441 008c FFF7FEFF 		bl	send_cmd
 1442              	.LVL164:
 1443 0090 D3E7     		b	.L127
 1444              	.L135:
 386:Core/Src/sd_card_spi.c **** 		}
 1445              		.loc 1 386 40 view .LVU376
 1446 0092 0124     		movs	r4, #1
 1447              	.LVL165:
 386:Core/Src/sd_card_spi.c **** 		}
 1448              		.loc 1 386 40 view .LVU377
 1449 0094 E4E7     		b	.L126
 1450              	.LVL166:
 1451              	.L130:
 1452              		.cfi_def_cfa_offset 0
 1453              		.cfi_restore 4
 1454              		.cfi_restore 5
 1455              		.cfi_restore 6
 1456              		.cfi_restore 14
 367:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1457              		.loc 1 367 28 view .LVU378
 1458 0096 0420     		movs	r0, #4
 1459              	.LVL167:
 1460              		.loc 1 392 1 view .LVU379
 1461 0098 7047     		bx	lr
 1462              	.LVL168:
 1463              	.L131:
 1464              		.cfi_def_cfa_offset 16
 1465              		.cfi_offset 4, -16
 1466              		.cfi_offset 5, -12
 1467              		.cfi_offset 6, -8
 1468              		.cfi_offset 14, -4
 367:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1469              		.loc 1 367 28 view .LVU380
 1470 009a 0420     		movs	r0, #4
 1471              	.LVL169:
 367:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1472              		.loc 1 367 28 view .LVU381
 1473 009c E5E7     		b	.L123
 1474              	.LVL170:
 1475              	.L132:
 368:Core/Src/sd_card_spi.c **** 	if (Stat & STA_PROTECT) return RES_WRPRT;	/* Check write protect */
 1476              		.loc 1 368 32 view .LVU382
 1477 009e 0320     		movs	r0, #3
 1478              	.LVL171:
 368:Core/Src/sd_card_spi.c **** 	if (Stat & STA_PROTECT) return RES_WRPRT;	/* Check write protect */
 1479              		.loc 1 368 32 view .LVU383
 1480 00a0 E3E7     		b	.L123
 1481              	.LVL172:
 1482              	.L133:
 369:Core/Src/sd_card_spi.c **** 
 1483              		.loc 1 369 33 view .LVU384
 1484 00a2 0220     		movs	r0, #2
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 37


 1485              	.LVL173:
 369:Core/Src/sd_card_spi.c **** 
 1486              		.loc 1 369 33 view .LVU385
 1487 00a4 E1E7     		b	.L123
 1488              	.L143:
 1489 00a6 00BF     		.align	2
 1490              	.L142:
 1491 00a8 00000000 		.word	Stat
 1492 00ac 00000000 		.word	CardType
 1493              		.cfi_endproc
 1494              	.LFE137:
 1496              		.section	.text.USER_SPI_ioctl,"ax",%progbits
 1497              		.align	1
 1498              		.global	USER_SPI_ioctl
 1499              		.syntax unified
 1500              		.thumb
 1501              		.thumb_func
 1503              	USER_SPI_ioctl:
 1504              	.LVL174:
 1505              	.LFB138:
 393:Core/Src/sd_card_spi.c **** #endif
 394:Core/Src/sd_card_spi.c **** 
 395:Core/Src/sd_card_spi.c **** 
 396:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 397:Core/Src/sd_card_spi.c **** /* Miscellaneous drive controls other than data read/write               */
 398:Core/Src/sd_card_spi.c **** /*-----------------------------------------------------------------------*/
 399:Core/Src/sd_card_spi.c **** 
 400:Core/Src/sd_card_spi.c **** #if _USE_IOCTL
 401:Core/Src/sd_card_spi.c **** inline DRESULT USER_SPI_ioctl (
 402:Core/Src/sd_card_spi.c **** 	BYTE drv,		/* Physical drive number (0) */
 403:Core/Src/sd_card_spi.c **** 	BYTE cmd,		/* Control command code */
 404:Core/Src/sd_card_spi.c **** 	void *buff		/* Pointer to the conrtol data */
 405:Core/Src/sd_card_spi.c **** )
 406:Core/Src/sd_card_spi.c **** {
 1506              		.loc 1 406 1 is_stmt 1 view -0
 1507              		.cfi_startproc
 1508              		@ args = 0, pretend = 0, frame = 16
 1509              		@ frame_needed = 0, uses_anonymous_args = 0
 1510              		.loc 1 406 1 is_stmt 0 view .LVU387
 1511 0000 70B5     		push	{r4, r5, r6, lr}
 1512              		.cfi_def_cfa_offset 16
 1513              		.cfi_offset 4, -16
 1514              		.cfi_offset 5, -12
 1515              		.cfi_offset 6, -8
 1516              		.cfi_offset 14, -4
 1517 0002 84B0     		sub	sp, sp, #16
 1518              		.cfi_def_cfa_offset 32
 407:Core/Src/sd_card_spi.c **** 	DRESULT res;
 1519              		.loc 1 407 2 is_stmt 1 view .LVU388
 408:Core/Src/sd_card_spi.c **** 	BYTE n, csd[16];
 1520              		.loc 1 408 2 view .LVU389
 409:Core/Src/sd_card_spi.c **** 	DWORD *dp, st, ed, csize;
 1521              		.loc 1 409 2 view .LVU390
 410:Core/Src/sd_card_spi.c **** 
 411:Core/Src/sd_card_spi.c **** 
 412:Core/Src/sd_card_spi.c **** 	if (drv) return RES_PARERR;					/* Check parameter */
 1522              		.loc 1 412 2 view .LVU391
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 38


 1523              		.loc 1 412 5 is_stmt 0 view .LVU392
 1524 0004 0028     		cmp	r0, #0
 1525 0006 40F00481 		bne	.L159
 1526 000a 0D46     		mov	r5, r1
 1527 000c 1646     		mov	r6, r2
 413:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1528              		.loc 1 413 2 is_stmt 1 view .LVU393
 1529              		.loc 1 413 11 is_stmt 0 view .LVU394
 1530 000e 834B     		ldr	r3, .L184
 1531 0010 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1532              		.loc 1 413 5 view .LVU395
 1533 0012 13F0010F 		tst	r3, #1
 1534 0016 40F0FE80 		bne	.L160
 414:Core/Src/sd_card_spi.c **** 
 415:Core/Src/sd_card_spi.c **** 	res = RES_ERROR;
 1535              		.loc 1 415 2 is_stmt 1 view .LVU396
 1536              	.LVL175:
 416:Core/Src/sd_card_spi.c **** 
 417:Core/Src/sd_card_spi.c **** 	switch (cmd) {
 1537              		.loc 1 417 2 view .LVU397
 1538 001a 0429     		cmp	r1, #4
 1539 001c 00F2ED80 		bhi	.L161
 1540 0020 DFE811F0 		tbh	[pc, r1, lsl #1]
 1541              	.L148:
 1542 0024 0500     		.2byte	(.L151-.L148)/2
 1543 0026 0C00     		.2byte	(.L150-.L148)/2
 1544 0028 EB00     		.2byte	(.L161-.L148)/2
 1545 002a 5400     		.2byte	(.L149-.L148)/2
 1546 002c AF00     		.2byte	(.L147-.L148)/2
 1547              		.p2align 1
 1548              	.L151:
 418:Core/Src/sd_card_spi.c **** 	case CTRL_SYNC :		/* Wait for end of internal write process of the drive */
 419:Core/Src/sd_card_spi.c **** 		if (spiselect()) res = RES_OK;
 1549              		.loc 1 419 3 view .LVU398
 1550              		.loc 1 419 7 is_stmt 0 view .LVU399
 1551 002e FFF7FEFF 		bl	spiselect
 1552              	.LVL176:
 1553              		.loc 1 419 6 view .LVU400
 1554 0032 0028     		cmp	r0, #0
 1555 0034 40F0E380 		bne	.L162
 415:Core/Src/sd_card_spi.c **** 
 1556              		.loc 1 415 6 view .LVU401
 1557 0038 0124     		movs	r4, #1
 1558 003a 06E0     		b	.L146
 1559              	.LVL177:
 1560              	.L150:
 420:Core/Src/sd_card_spi.c **** 		break;
 421:Core/Src/sd_card_spi.c **** 
 422:Core/Src/sd_card_spi.c **** 	case GET_SECTOR_COUNT :	/* Get drive capacity in unit of sector (DWORD) */
 423:Core/Src/sd_card_spi.c **** 		if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16)) {
 1561              		.loc 1 423 3 is_stmt 1 view .LVU402
 1562              		.loc 1 423 8 is_stmt 0 view .LVU403
 1563 003c 0021     		movs	r1, #0
 1564              	.LVL178:
 1565              		.loc 1 423 8 view .LVU404
 1566 003e 0920     		movs	r0, #9
 1567              	.LVL179:
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 39


 1568              		.loc 1 423 8 view .LVU405
 1569 0040 FFF7FEFF 		bl	send_cmd
 1570              	.LVL180:
 1571              		.loc 1 423 6 view .LVU406
 1572 0044 0446     		mov	r4, r0
 1573 0046 28B1     		cbz	r0, .L176
 415:Core/Src/sd_card_spi.c **** 
 1574              		.loc 1 415 6 view .LVU407
 1575 0048 2C46     		mov	r4, r5
 1576              	.LVL181:
 1577              	.L146:
 424:Core/Src/sd_card_spi.c **** 			if ((csd[0] >> 6) == 1) {	/* SDC ver 2.00 */
 425:Core/Src/sd_card_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 426:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 427:Core/Src/sd_card_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 428:Core/Src/sd_card_spi.c **** 				n = (csd[5] & 15) + ((csd[10] & 128) >> 7) + ((csd[9] & 3) << 1) + 2;
 429:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 430:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 431:Core/Src/sd_card_spi.c **** 			}
 432:Core/Src/sd_card_spi.c **** 			res = RES_OK;
 433:Core/Src/sd_card_spi.c **** 		}
 434:Core/Src/sd_card_spi.c **** 		break;
 435:Core/Src/sd_card_spi.c **** 
 436:Core/Src/sd_card_spi.c **** 	case GET_BLOCK_SIZE :	/* Get erase block size in unit of sector (DWORD) */
 437:Core/Src/sd_card_spi.c **** 		if (CardType & CT_SD2) {	/* SDC ver 2.00 */
 438:Core/Src/sd_card_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 439:Core/Src/sd_card_spi.c **** 				xchg_spi(0xFF);
 440:Core/Src/sd_card_spi.c **** 				if (rcvr_datablock(csd, 16)) {				/* Read partial block */
 441:Core/Src/sd_card_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 442:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 443:Core/Src/sd_card_spi.c **** 					res = RES_OK;
 444:Core/Src/sd_card_spi.c **** 				}
 445:Core/Src/sd_card_spi.c **** 			}
 446:Core/Src/sd_card_spi.c **** 		} else {					/* SDC ver 1.XX or MMC */
 447:Core/Src/sd_card_spi.c **** 			if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16)) {	/* Read CSD */
 448:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 449:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 450:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 451:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = ((WORD)((csd[10] & 124) >> 2) + 1) * (((csd[11] & 3) << 3) + ((csd[11] & 224) 
 452:Core/Src/sd_card_spi.c **** 				}
 453:Core/Src/sd_card_spi.c **** 				res = RES_OK;
 454:Core/Src/sd_card_spi.c **** 			}
 455:Core/Src/sd_card_spi.c **** 		}
 456:Core/Src/sd_card_spi.c **** 		break;
 457:Core/Src/sd_card_spi.c **** 
 458:Core/Src/sd_card_spi.c **** 	case CTRL_TRIM :	/* Erase a block of sectors (used when _USE_ERASE == 1) */
 459:Core/Src/sd_card_spi.c **** 		if (!(CardType & CT_SDC)) break;				/* Check if the card is SDC */
 460:Core/Src/sd_card_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 461:Core/Src/sd_card_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 462:Core/Src/sd_card_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 463:Core/Src/sd_card_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 464:Core/Src/sd_card_spi.c **** 			st *= 512; ed *= 512;
 465:Core/Src/sd_card_spi.c **** 		}
 466:Core/Src/sd_card_spi.c **** 		if (send_cmd(CMD32, st) == 0 && send_cmd(CMD33, ed) == 0 && send_cmd(CMD38, 0) == 0 && wait_ready
 467:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 468:Core/Src/sd_card_spi.c **** 		}
 469:Core/Src/sd_card_spi.c **** 		break;
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 40


 470:Core/Src/sd_card_spi.c **** 
 471:Core/Src/sd_card_spi.c **** 	default:
 472:Core/Src/sd_card_spi.c **** 		res = RES_PARERR;
 473:Core/Src/sd_card_spi.c **** 	}
 474:Core/Src/sd_card_spi.c **** 
 475:Core/Src/sd_card_spi.c **** 	despiselect();
 1578              		.loc 1 475 2 is_stmt 1 view .LVU408
 1579 004a FFF7FEFF 		bl	despiselect
 1580              	.LVL182:
 476:Core/Src/sd_card_spi.c **** 
 477:Core/Src/sd_card_spi.c **** 	return res;
 1581              		.loc 1 477 2 view .LVU409
 1582              	.L145:
 478:Core/Src/sd_card_spi.c **** }
 1583              		.loc 1 478 1 is_stmt 0 view .LVU410
 1584 004e 2046     		mov	r0, r4
 1585 0050 04B0     		add	sp, sp, #16
 1586              		.cfi_remember_state
 1587              		.cfi_def_cfa_offset 16
 1588              		@ sp needed
 1589 0052 70BD     		pop	{r4, r5, r6, pc}
 1590              	.LVL183:
 1591              	.L176:
 1592              		.cfi_restore_state
 423:Core/Src/sd_card_spi.c **** 			if ((csd[0] >> 6) == 1) {	/* SDC ver 2.00 */
 1593              		.loc 1 423 35 discriminator 1 view .LVU411
 1594 0054 1021     		movs	r1, #16
 1595 0056 6846     		mov	r0, sp
 1596 0058 FFF7FEFF 		bl	rcvr_datablock
 1597              	.LVL184:
 423:Core/Src/sd_card_spi.c **** 			if ((csd[0] >> 6) == 1) {	/* SDC ver 2.00 */
 1598              		.loc 1 423 32 discriminator 1 view .LVU412
 1599 005c 0028     		cmp	r0, #0
 1600 005e 00F0D080 		beq	.L164
 424:Core/Src/sd_card_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1601              		.loc 1 424 4 is_stmt 1 view .LVU413
 424:Core/Src/sd_card_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1602              		.loc 1 424 12 is_stmt 0 view .LVU414
 1603 0062 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 424:Core/Src/sd_card_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1604              		.loc 1 424 22 view .LVU415
 1605 0066 9B09     		lsrs	r3, r3, #6
 424:Core/Src/sd_card_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1606              		.loc 1 424 7 view .LVU416
 1607 0068 012B     		cmp	r3, #1
 1608 006a 1FD0     		beq	.L177
 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1609              		.loc 1 428 5 is_stmt 1 view .LVU417
 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1610              		.loc 1 428 13 is_stmt 0 view .LVU418
 1611 006c 9DF80520 		ldrb	r2, [sp, #5]	@ zero_extendqisi2
 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1612              		.loc 1 428 17 view .LVU419
 1613 0070 02F00F02 		and	r2, r2, #15
 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1614              		.loc 1 428 30 view .LVU420
 1615 0074 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 41


 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1616              		.loc 1 428 23 view .LVU421
 1617 0078 02EBD312 		add	r2, r2, r3, lsr #7
 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1618              		.loc 1 428 55 view .LVU422
 1619 007c 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1620              		.loc 1 428 64 view .LVU423
 1621 0080 5B00     		lsls	r3, r3, #1
 1622 0082 03F00603 		and	r3, r3, #6
 428:Core/Src/sd_card_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1623              		.loc 1 428 48 view .LVU424
 1624 0086 1A44     		add	r2, r2, r3
 1625              	.LVL185:
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1626              		.loc 1 429 5 is_stmt 1 view .LVU425
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1627              		.loc 1 429 17 is_stmt 0 view .LVU426
 1628 0088 9DF80810 		ldrb	r1, [sp, #8]	@ zero_extendqisi2
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1629              		.loc 1 429 39 view .LVU427
 1630 008c 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1631              		.loc 1 429 43 view .LVU428
 1632 0090 9B00     		lsls	r3, r3, #2
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1633              		.loc 1 429 27 view .LVU429
 1634 0092 03EB9113 		add	r3, r3, r1, lsr #6
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1635              		.loc 1 429 62 view .LVU430
 1636 0096 9DF80610 		ldrb	r1, [sp, #6]	@ zero_extendqisi2
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1637              		.loc 1 429 71 view .LVU431
 1638 009a 8902     		lsls	r1, r1, #10
 1639 009c 01F44061 		and	r1, r1, #3072
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1640              		.loc 1 429 49 view .LVU432
 1641 00a0 0B44     		add	r3, r3, r1
 429:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1642              		.loc 1 429 78 view .LVU433
 1643 00a2 0133     		adds	r3, r3, #1
 1644              	.LVL186:
 430:Core/Src/sd_card_spi.c **** 			}
 1645              		.loc 1 430 5 is_stmt 1 view .LVU434
 430:Core/Src/sd_card_spi.c **** 			}
 1646              		.loc 1 430 33 is_stmt 0 view .LVU435
 1647 00a4 073A     		subs	r2, r2, #7
 1648              	.LVL187:
 430:Core/Src/sd_card_spi.c **** 			}
 1649              		.loc 1 430 27 view .LVU436
 1650 00a6 9340     		lsls	r3, r3, r2
 1651              	.LVL188:
 430:Core/Src/sd_card_spi.c **** 			}
 1652              		.loc 1 430 19 view .LVU437
 1653 00a8 3360     		str	r3, [r6]
 1654              	.LVL189:
 430:Core/Src/sd_card_spi.c **** 			}
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 42


 1655              		.loc 1 430 19 view .LVU438
 1656 00aa CEE7     		b	.L146
 1657              	.LVL190:
 1658              	.L177:
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1659              		.loc 1 425 5 is_stmt 1 view .LVU439
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1660              		.loc 1 425 16 is_stmt 0 view .LVU440
 1661 00ac 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1662              		.loc 1 425 32 view .LVU441
 1663 00b0 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1664              		.loc 1 425 20 view .LVU442
 1665 00b4 03EB0223 		add	r3, r3, r2, lsl #8
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1666              		.loc 1 425 56 view .LVU443
 1667 00b8 9DF80720 		ldrb	r2, [sp, #7]	@ zero_extendqisi2
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1668              		.loc 1 425 66 view .LVU444
 1669 00bc 1204     		lsls	r2, r2, #16
 1670 00be 02F47C12 		and	r2, r2, #4128768
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1671              		.loc 1 425 42 view .LVU445
 1672 00c2 1344     		add	r3, r3, r2
 425:Core/Src/sd_card_spi.c **** 				*(DWORD*)buff = csize << 10;
 1673              		.loc 1 425 11 view .LVU446
 1674 00c4 0133     		adds	r3, r3, #1
 1675              	.LVL191:
 426:Core/Src/sd_card_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 1676              		.loc 1 426 5 is_stmt 1 view .LVU447
 426:Core/Src/sd_card_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 1677              		.loc 1 426 27 is_stmt 0 view .LVU448
 1678 00c6 9B02     		lsls	r3, r3, #10
 1679              	.LVL192:
 426:Core/Src/sd_card_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 1680              		.loc 1 426 19 view .LVU449
 1681 00c8 3360     		str	r3, [r6]
 1682              	.LVL193:
 426:Core/Src/sd_card_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 1683              		.loc 1 426 19 view .LVU450
 1684 00ca BEE7     		b	.L146
 1685              	.LVL194:
 1686              	.L149:
 437:Core/Src/sd_card_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 1687              		.loc 1 437 3 is_stmt 1 view .LVU451
 437:Core/Src/sd_card_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 1688              		.loc 1 437 16 is_stmt 0 view .LVU452
 1689 00cc 544B     		ldr	r3, .L184+4
 1690 00ce 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 437:Core/Src/sd_card_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 1691              		.loc 1 437 6 view .LVU453
 1692 00d0 13F0040F 		tst	r3, #4
 1693 00d4 20D0     		beq	.L153
 438:Core/Src/sd_card_spi.c **** 				xchg_spi(0xFF);
 1694              		.loc 1 438 4 is_stmt 1 view .LVU454
 438:Core/Src/sd_card_spi.c **** 				xchg_spi(0xFF);
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 43


 1695              		.loc 1 438 8 is_stmt 0 view .LVU455
 1696 00d6 0021     		movs	r1, #0
 1697              	.LVL195:
 438:Core/Src/sd_card_spi.c **** 				xchg_spi(0xFF);
 1698              		.loc 1 438 8 view .LVU456
 1699 00d8 8D20     		movs	r0, #141
 1700              	.LVL196:
 438:Core/Src/sd_card_spi.c **** 				xchg_spi(0xFF);
 1701              		.loc 1 438 8 view .LVU457
 1702 00da FFF7FEFF 		bl	send_cmd
 1703              	.LVL197:
 438:Core/Src/sd_card_spi.c **** 				xchg_spi(0xFF);
 1704              		.loc 1 438 7 view .LVU458
 1705 00de 08B1     		cbz	r0, .L178
 415:Core/Src/sd_card_spi.c **** 
 1706              		.loc 1 415 6 view .LVU459
 1707 00e0 0124     		movs	r4, #1
 1708 00e2 B2E7     		b	.L146
 1709              	.L178:
 439:Core/Src/sd_card_spi.c **** 				if (rcvr_datablock(csd, 16)) {				/* Read partial block */
 1710              		.loc 1 439 5 is_stmt 1 view .LVU460
 1711 00e4 FF20     		movs	r0, #255
 1712 00e6 FFF7FEFF 		bl	xchg_spi
 1713              	.LVL198:
 440:Core/Src/sd_card_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 1714              		.loc 1 440 5 view .LVU461
 440:Core/Src/sd_card_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 1715              		.loc 1 440 9 is_stmt 0 view .LVU462
 1716 00ea 1021     		movs	r1, #16
 1717 00ec 6846     		mov	r0, sp
 1718 00ee FFF7FEFF 		bl	rcvr_datablock
 1719              	.LVL199:
 440:Core/Src/sd_card_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 1720              		.loc 1 440 8 view .LVU463
 1721 00f2 78B9     		cbnz	r0, .L166
 415:Core/Src/sd_card_spi.c **** 
 1722              		.loc 1 415 6 view .LVU464
 1723 00f4 0124     		movs	r4, #1
 1724 00f6 A8E7     		b	.L146
 1725              	.LVL200:
 1726              	.L155:
 441:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1727              		.loc 1 441 32 is_stmt 1 discriminator 3 view .LVU465
 1728 00f8 FF20     		movs	r0, #255
 1729 00fa FFF7FEFF 		bl	xchg_spi
 1730              	.LVL201:
 441:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1731              		.loc 1 441 28 discriminator 3 view .LVU466
 1732 00fe 013C     		subs	r4, r4, #1
 1733              	.LVL202:
 441:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1734              		.loc 1 441 28 is_stmt 0 discriminator 3 view .LVU467
 1735 0100 E4B2     		uxtb	r4, r4
 1736              	.LVL203:
 1737              	.L154:
 441:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1738              		.loc 1 441 24 is_stmt 1 discriminator 1 view .LVU468
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 44


 1739 0102 002C     		cmp	r4, #0
 1740 0104 F8D1     		bne	.L155
 442:Core/Src/sd_card_spi.c **** 					res = RES_OK;
 1741              		.loc 1 442 6 view .LVU469
 442:Core/Src/sd_card_spi.c **** 					res = RES_OK;
 1742              		.loc 1 442 34 is_stmt 0 view .LVU470
 1743 0106 9DF80A20 		ldrb	r2, [sp, #10]	@ zero_extendqisi2
 442:Core/Src/sd_card_spi.c **** 					res = RES_OK;
 1744              		.loc 1 442 39 view .LVU471
 1745 010a 1209     		lsrs	r2, r2, #4
 442:Core/Src/sd_card_spi.c **** 					res = RES_OK;
 1746              		.loc 1 442 27 view .LVU472
 1747 010c 1023     		movs	r3, #16
 1748 010e 9340     		lsls	r3, r3, r2
 442:Core/Src/sd_card_spi.c **** 					res = RES_OK;
 1749              		.loc 1 442 20 view .LVU473
 1750 0110 3360     		str	r3, [r6]
 443:Core/Src/sd_card_spi.c **** 				}
 1751              		.loc 1 443 6 is_stmt 1 view .LVU474
 1752              	.LVL204:
 443:Core/Src/sd_card_spi.c **** 				}
 1753              		.loc 1 443 6 is_stmt 0 view .LVU475
 1754 0112 9AE7     		b	.L146
 1755              	.LVL205:
 1756              	.L166:
 441:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1757              		.loc 1 441 13 view .LVU476
 1758 0114 3024     		movs	r4, #48
 1759 0116 F4E7     		b	.L154
 1760              	.LVL206:
 1761              	.L153:
 447:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1762              		.loc 1 447 4 is_stmt 1 view .LVU477
 447:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1763              		.loc 1 447 9 is_stmt 0 view .LVU478
 1764 0118 0021     		movs	r1, #0
 1765              	.LVL207:
 447:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1766              		.loc 1 447 9 view .LVU479
 1767 011a 0920     		movs	r0, #9
 1768              	.LVL208:
 447:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1769              		.loc 1 447 9 view .LVU480
 1770 011c FFF7FEFF 		bl	send_cmd
 1771              	.LVL209:
 447:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1772              		.loc 1 447 7 view .LVU481
 1773 0120 0546     		mov	r5, r0
 1774 0122 08B1     		cbz	r0, .L179
 415:Core/Src/sd_card_spi.c **** 
 1775              		.loc 1 415 6 view .LVU482
 1776 0124 0124     		movs	r4, #1
 1777 0126 90E7     		b	.L146
 1778              	.L179:
 447:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1779              		.loc 1 447 36 discriminator 1 view .LVU483
 1780 0128 1021     		movs	r1, #16
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 45


 1781 012a 6846     		mov	r0, sp
 1782 012c FFF7FEFF 		bl	rcvr_datablock
 1783              	.LVL210:
 447:Core/Src/sd_card_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1784              		.loc 1 447 33 discriminator 1 view .LVU484
 1785 0130 0028     		cmp	r0, #0
 1786 0132 68D0     		beq	.L168
 448:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1787              		.loc 1 448 5 is_stmt 1 view .LVU485
 448:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1788              		.loc 1 448 18 is_stmt 0 view .LVU486
 1789 0134 3A4B     		ldr	r3, .L184+4
 1790 0136 1C78     		ldrb	r4, [r3]	@ zero_extendqisi2
 448:Core/Src/sd_card_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1791              		.loc 1 448 8 view .LVU487
 1792 0138 14F00204 		ands	r4, r4, #2
 1793 013c 11D0     		beq	.L156
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1794              		.loc 1 449 6 is_stmt 1 view .LVU488
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1795              		.loc 1 449 28 is_stmt 0 view .LVU489
 1796 013e 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1797              		.loc 1 449 39 view .LVU490
 1798 0142 5B00     		lsls	r3, r3, #1
 1799 0144 03F07E03 		and	r3, r3, #126
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1800              		.loc 1 449 58 view .LVU491
 1801 0148 9DF80B20 		ldrb	r2, [sp, #11]	@ zero_extendqisi2
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1802              		.loc 1 449 45 view .LVU492
 1803 014c 03EBD213 		add	r3, r3, r2, lsr #7
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1804              		.loc 1 449 76 view .LVU493
 1805 0150 0133     		adds	r3, r3, #1
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1806              		.loc 1 449 89 view .LVU494
 1807 0152 9DF80D20 		ldrb	r2, [sp, #13]	@ zero_extendqisi2
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1808              		.loc 1 449 94 view .LVU495
 1809 0156 9209     		lsrs	r2, r2, #6
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1810              		.loc 1 449 100 view .LVU496
 1811 0158 013A     		subs	r2, r2, #1
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1812              		.loc 1 449 81 view .LVU497
 1813 015a 9340     		lsls	r3, r3, r2
 449:Core/Src/sd_card_spi.c **** 				} else {					/* MMC */
 1814              		.loc 1 449 20 view .LVU498
 1815 015c 3360     		str	r3, [r6]
 453:Core/Src/sd_card_spi.c **** 			}
 1816              		.loc 1 453 9 view .LVU499
 1817 015e 2C46     		mov	r4, r5
 1818 0160 73E7     		b	.L146
 1819              	.L156:
 451:Core/Src/sd_card_spi.c **** 				}
 1820              		.loc 1 451 6 is_stmt 1 view .LVU500
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 46


 451:Core/Src/sd_card_spi.c **** 				}
 1821              		.loc 1 451 34 is_stmt 0 view .LVU501
 1822 0162 9DF80A20 		ldrb	r2, [sp, #10]	@ zero_extendqisi2
 451:Core/Src/sd_card_spi.c **** 				}
 1823              		.loc 1 451 23 view .LVU502
 1824 0166 C2F38402 		ubfx	r2, r2, #2, #5
 451:Core/Src/sd_card_spi.c **** 				}
 1825              		.loc 1 451 65 view .LVU503
 1826 016a 9DF80B10 		ldrb	r1, [sp, #11]	@ zero_extendqisi2
 451:Core/Src/sd_card_spi.c **** 				}
 1827              		.loc 1 451 75 view .LVU504
 1828 016e CB00     		lsls	r3, r1, #3
 1829 0170 03F01803 		and	r3, r3, #24
 451:Core/Src/sd_card_spi.c **** 				}
 1830              		.loc 1 451 81 view .LVU505
 1831 0174 03EB5113 		add	r3, r3, r1, lsr #5
 451:Core/Src/sd_card_spi.c **** 				}
 1832              		.loc 1 451 106 view .LVU506
 1833 0178 0133     		adds	r3, r3, #1
 451:Core/Src/sd_card_spi.c **** 				}
 1834              		.loc 1 451 57 view .LVU507
 1835 017a 02FB0333 		mla	r3, r2, r3, r3
 451:Core/Src/sd_card_spi.c **** 				}
 1836              		.loc 1 451 20 view .LVU508
 1837 017e 3360     		str	r3, [r6]
 1838 0180 63E7     		b	.L146
 1839              	.LVL211:
 1840              	.L147:
 459:Core/Src/sd_card_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 1841              		.loc 1 459 3 is_stmt 1 view .LVU509
 459:Core/Src/sd_card_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 1842              		.loc 1 459 18 is_stmt 0 view .LVU510
 1843 0182 274B     		ldr	r3, .L184+4
 1844 0184 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 459:Core/Src/sd_card_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 1845              		.loc 1 459 6 view .LVU511
 1846 0186 13F0060F 		tst	r3, #6
 1847 018a 01D1     		bne	.L180
 415:Core/Src/sd_card_spi.c **** 
 1848              		.loc 1 415 6 view .LVU512
 1849 018c 0124     		movs	r4, #1
 1850 018e 5CE7     		b	.L146
 1851              	.L180:
 460:Core/Src/sd_card_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1852              		.loc 1 460 3 is_stmt 1 view .LVU513
 460:Core/Src/sd_card_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1853              		.loc 1 460 7 is_stmt 0 view .LVU514
 1854 0190 6A46     		mov	r2, sp
 1855              	.LVL212:
 460:Core/Src/sd_card_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1856              		.loc 1 460 7 view .LVU515
 1857 0192 0B21     		movs	r1, #11
 1858              	.LVL213:
 460:Core/Src/sd_card_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1859              		.loc 1 460 7 view .LVU516
 1860 0194 FFF7FEFF 		bl	USER_SPI_ioctl
 1861              	.LVL214:
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 47


 460:Core/Src/sd_card_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1862              		.loc 1 460 6 view .LVU517
 1863 0198 B8BB     		cbnz	r0, .L170
 461:Core/Src/sd_card_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1864              		.loc 1 461 3 is_stmt 1 view .LVU518
 461:Core/Src/sd_card_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1865              		.loc 1 461 12 is_stmt 0 view .LVU519
 1866 019a 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 461:Core/Src/sd_card_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1867              		.loc 1 461 6 view .LVU520
 1868 019e 9B09     		lsrs	r3, r3, #6
 1869 01a0 04D1     		bne	.L157
 461:Core/Src/sd_card_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1870              		.loc 1 461 30 discriminator 1 view .LVU521
 1871 01a2 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 461:Core/Src/sd_card_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1872              		.loc 1 461 22 discriminator 1 view .LVU522
 1873 01a6 13F0400F 		tst	r3, #64
 1874 01aa 30D0     		beq	.L171
 1875              	.L157:
 462:Core/Src/sd_card_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1876              		.loc 1 462 3 is_stmt 1 view .LVU523
 1877              	.LVL215:
 462:Core/Src/sd_card_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1878              		.loc 1 462 14 view .LVU524
 462:Core/Src/sd_card_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1879              		.loc 1 462 17 is_stmt 0 view .LVU525
 1880 01ac 3168     		ldr	r1, [r6]
 1881              	.LVL216:
 462:Core/Src/sd_card_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1882              		.loc 1 462 26 is_stmt 1 view .LVU526
 462:Core/Src/sd_card_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1883              		.loc 1 462 29 is_stmt 0 view .LVU527
 1884 01ae 7468     		ldr	r4, [r6, #4]
 1885              	.LVL217:
 463:Core/Src/sd_card_spi.c **** 			st *= 512; ed *= 512;
 1886              		.loc 1 463 3 is_stmt 1 view .LVU528
 463:Core/Src/sd_card_spi.c **** 			st *= 512; ed *= 512;
 1887              		.loc 1 463 18 is_stmt 0 view .LVU529
 1888 01b0 1B4B     		ldr	r3, .L184+4
 1889 01b2 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 463:Core/Src/sd_card_spi.c **** 			st *= 512; ed *= 512;
 1890              		.loc 1 463 6 view .LVU530
 1891 01b4 13F0080F 		tst	r3, #8
 1892 01b8 01D1     		bne	.L158
 464:Core/Src/sd_card_spi.c **** 		}
 1893              		.loc 1 464 4 is_stmt 1 view .LVU531
 464:Core/Src/sd_card_spi.c **** 		}
 1894              		.loc 1 464 7 is_stmt 0 view .LVU532
 1895 01ba 4902     		lsls	r1, r1, #9
 1896              	.LVL218:
 464:Core/Src/sd_card_spi.c **** 		}
 1897              		.loc 1 464 15 is_stmt 1 view .LVU533
 464:Core/Src/sd_card_spi.c **** 		}
 1898              		.loc 1 464 18 is_stmt 0 view .LVU534
 1899 01bc 6402     		lsls	r4, r4, #9
 1900              	.LVL219:
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 48


 1901              	.L158:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1902              		.loc 1 466 3 is_stmt 1 view .LVU535
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1903              		.loc 1 466 7 is_stmt 0 view .LVU536
 1904 01be 2020     		movs	r0, #32
 1905 01c0 FFF7FEFF 		bl	send_cmd
 1906              	.LVL220:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1907              		.loc 1 466 6 view .LVU537
 1908 01c4 08B1     		cbz	r0, .L181
 415:Core/Src/sd_card_spi.c **** 
 1909              		.loc 1 415 6 view .LVU538
 1910 01c6 0124     		movs	r4, #1
 1911              	.LVL221:
 415:Core/Src/sd_card_spi.c **** 
 1912              		.loc 1 415 6 view .LVU539
 1913 01c8 3FE7     		b	.L146
 1914              	.LVL222:
 1915              	.L181:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1916              		.loc 1 466 35 discriminator 1 view .LVU540
 1917 01ca 2146     		mov	r1, r4
 1918 01cc 2120     		movs	r0, #33
 1919 01ce FFF7FEFF 		bl	send_cmd
 1920              	.LVL223:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1921              		.loc 1 466 32 discriminator 1 view .LVU541
 1922 01d2 08B1     		cbz	r0, .L182
 415:Core/Src/sd_card_spi.c **** 
 1923              		.loc 1 415 6 view .LVU542
 1924 01d4 0124     		movs	r4, #1
 1925              	.LVL224:
 415:Core/Src/sd_card_spi.c **** 
 1926              		.loc 1 415 6 view .LVU543
 1927 01d6 38E7     		b	.L146
 1928              	.LVL225:
 1929              	.L182:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1930              		.loc 1 466 63 discriminator 2 view .LVU544
 1931 01d8 0021     		movs	r1, #0
 1932 01da 2620     		movs	r0, #38
 1933 01dc FFF7FEFF 		bl	send_cmd
 1934              	.LVL226:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1935              		.loc 1 466 60 discriminator 2 view .LVU545
 1936 01e0 0446     		mov	r4, r0
 1937              	.LVL227:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1938              		.loc 1 466 60 discriminator 2 view .LVU546
 1939 01e2 08B1     		cbz	r0, .L183
 415:Core/Src/sd_card_spi.c **** 
 1940              		.loc 1 415 6 view .LVU547
 1941 01e4 0124     		movs	r4, #1
 1942 01e6 30E7     		b	.L146
 1943              	.L183:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 49


 1944              		.loc 1 466 90 discriminator 3 view .LVU548
 1945 01e8 47F23050 		movw	r0, #30000
 1946 01ec FFF7FEFF 		bl	wait_ready
 1947              	.LVL228:
 466:Core/Src/sd_card_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1948              		.loc 1 466 87 discriminator 3 view .LVU549
 1949 01f0 0028     		cmp	r0, #0
 1950 01f2 7FF42AAF 		bne	.L146
 415:Core/Src/sd_card_spi.c **** 
 1951              		.loc 1 415 6 view .LVU550
 1952 01f6 0124     		movs	r4, #1
 1953 01f8 27E7     		b	.L146
 1954              	.LVL229:
 1955              	.L161:
 417:Core/Src/sd_card_spi.c **** 	case CTRL_SYNC :		/* Wait for end of internal write process of the drive */
 1956              		.loc 1 417 2 view .LVU551
 1957 01fa 0424     		movs	r4, #4
 1958 01fc 25E7     		b	.L146
 1959              	.LVL230:
 1960              	.L162:
 419:Core/Src/sd_card_spi.c **** 		break;
 1961              		.loc 1 419 24 view .LVU552
 1962 01fe 2C46     		mov	r4, r5
 1963 0200 23E7     		b	.L146
 1964              	.L164:
 415:Core/Src/sd_card_spi.c **** 
 1965              		.loc 1 415 6 view .LVU553
 1966 0202 2C46     		mov	r4, r5
 1967 0204 21E7     		b	.L146
 1968              	.L168:
 1969 0206 0124     		movs	r4, #1
 1970 0208 1FE7     		b	.L146
 1971              	.L170:
 1972 020a 0124     		movs	r4, #1
 1973 020c 1DE7     		b	.L146
 1974              	.L171:
 1975 020e 0124     		movs	r4, #1
 1976 0210 1BE7     		b	.L146
 1977              	.LVL231:
 1978              	.L159:
 412:Core/Src/sd_card_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1979              		.loc 1 412 18 view .LVU554
 1980 0212 0424     		movs	r4, #4
 1981 0214 1BE7     		b	.L145
 1982              	.L160:
 413:Core/Src/sd_card_spi.c **** 
 1983              		.loc 1 413 32 view .LVU555
 1984 0216 0324     		movs	r4, #3
 1985 0218 19E7     		b	.L145
 1986              	.L185:
 1987 021a 00BF     		.align	2
 1988              	.L184:
 1989 021c 00000000 		.word	Stat
 1990 0220 00000000 		.word	CardType
 1991              		.cfi_endproc
 1992              	.LFE138:
 1994              		.global	spiTimerTickDelay
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 50


 1995              		.section	.bss.spiTimerTickDelay,"aw",%nobits
 1996              		.align	2
 1999              	spiTimerTickDelay:
 2000 0000 00000000 		.space	4
 2001              		.global	spiTimerTickStart
 2002              		.section	.bss.spiTimerTickStart,"aw",%nobits
 2003              		.align	2
 2006              	spiTimerTickStart:
 2007 0000 00000000 		.space	4
 2008              		.section	.bss.CardType,"aw",%nobits
 2011              	CardType:
 2012 0000 00       		.space	1
 2013              		.section	.data.Stat,"aw"
 2016              	Stat:
 2017 0000 01       		.byte	1
 2018              		.text
 2019              	.Letext0:
 2020              		.file 2 "c:\\program files (x86)\\arm gnu toolchain arm-none-eabi\\12.2 mpacbti-bet1\\arm-none-eab
 2021              		.file 3 "c:\\program files (x86)\\arm gnu toolchain arm-none-eabi\\12.2 mpacbti-bet1\\arm-none-eab
 2022              		.file 4 "Drivers/CMSIS/Device/ST/STM32F3xx/Include/stm32f334x8.h"
 2023              		.file 5 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal_def.h"
 2024              		.file 6 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal_gpio.h"
 2025              		.file 7 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal_dma.h"
 2026              		.file 8 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal_spi.h"
 2027              		.file 9 "Middlewares/Third_Party/FatFs/src/integer.h"
 2028              		.file 10 "Middlewares/Third_Party/FatFs/src/diskio.h"
 2029              		.file 11 "Drivers/STM32F3xx_HAL_Driver/Inc/stm32f3xx_hal.h"
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 51


DEFINED SYMBOLS
                            *ABS*:00000000 sd_card_spi.c
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:21     .text.xchg_spi:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:26     .text.xchg_spi:00000000 xchg_spi
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:62     .text.xchg_spi:00000028 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:67     .text.wait_ready:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:72     .text.wait_ready:00000000 wait_ready
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:131    .text.rcvr_spi_multi:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:136    .text.rcvr_spi_multi:00000000 rcvr_spi_multi
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:184    .text.xmit_spi_multi:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:189    .text.xmit_spi_multi:00000000 xmit_spi_multi
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:234    .text.xmit_datablock:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:239    .text.xmit_datablock:00000000 xmit_datablock
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:318    .text.despiselect:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:323    .text.despiselect:00000000 despiselect
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:349    .text.despiselect:00000014 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:354    .text.spiselect:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:359    .text.spiselect:00000000 spiselect
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:404    .text.spiselect:0000002c $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:409    .text.send_cmd:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:414    .text.send_cmd:00000000 send_cmd
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:559    .text.SPI_Timer_On:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:565    .text.SPI_Timer_On:00000000 SPI_Timer_On
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:596    .text.SPI_Timer_On:00000014 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:2006   .bss.spiTimerTickStart:00000000 spiTimerTickStart
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1999   .bss.spiTimerTickDelay:00000000 spiTimerTickDelay
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:602    .text.SPI_Timer_Status:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:608    .text.SPI_Timer_Status:00000000 SPI_Timer_Status
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:638    .text.SPI_Timer_Status:0000001c $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:644    .text.rcvr_datablock:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:649    .text.rcvr_datablock:00000000 rcvr_datablock
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:723    .text.USER_SPI_initialize:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:729    .text.USER_SPI_initialize:00000000 USER_SPI_initialize
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1066   .text.USER_SPI_initialize:00000164 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:2016   .data.Stat:00000000 Stat
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:2011   .bss.CardType:00000000 CardType
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1073   .text.USER_SPI_status:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1079   .text.USER_SPI_status:00000000 USER_SPI_status
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1108   .text.USER_SPI_status:00000010 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1113   .text.USER_SPI_read:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1119   .text.USER_SPI_read:00000000 USER_SPI_read
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1280   .text.USER_SPI_read:00000084 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1286   .text.USER_SPI_write:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1292   .text.USER_SPI_write:00000000 USER_SPI_write
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1491   .text.USER_SPI_write:000000a8 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1497   .text.USER_SPI_ioctl:00000000 $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1503   .text.USER_SPI_ioctl:00000000 USER_SPI_ioctl
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1542   .text.USER_SPI_ioctl:00000024 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1547   .text.USER_SPI_ioctl:0000002e $t
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1989   .text.USER_SPI_ioctl:0000021c $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:1996   .bss.spiTimerTickDelay:00000000 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:2003   .bss.spiTimerTickStart:00000000 $d
C:\Users\cordi\AppData\Local\Temp\ccu38pij.s:2012   .bss.CardType:00000000 $d

UNDEFINED SYMBOLS
HAL_SPI_TransmitReceive
hspi1
ARM GAS  C:\Users\cordi\AppData\Local\Temp\ccu38pij.s 			page 52


HAL_GetTick
HAL_GPIO_WritePin
